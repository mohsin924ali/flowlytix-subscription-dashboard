(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[885],{49297:function(e,s,r){Promise.resolve().then(r.bind(r,33421))},33421:function(e,s,r){"use strict";r.r(s),r.d(s,{default:function(){return X}});var t=r(57437),i=r(2265),n=r(99376),a=r(1899),o=r(35389),l=r(63804),c=r(15735),d=r(5002),x=r(94013),u=r(67208),h=r(36137),p=r(97404),j=r(23996),Z=r(22095),m=r(70208),g=r(32281),b=r(54301),f=r(61201),v=r(59469),y=r(67116),C=r(67571),S=r(59253),D=r(59832),w=r(60407),P=r(57742),A=r(42187),k=r(53431),I=r(67051),W=r(35791),E=r(79507),z=r(77468),L=r(12258),T=r(9026),_=r(8444),N=r(29886),R=r(79335),F=r(57424),O=r(29541),B=r(5837),U=r(94395),K=r(54862),M=r(59939),V=r(82744),G=r(76672),H=r(30275),Q=r(27648),q=r(94599),J=r(6481);function X(){let e=(0,n.useRouter)(),{subscriptions:s,isLoading:r,error:X,deleteSubscription:$,updateSubscription:ee,suspendSubscription:es,resumeSubscription:er,fetchSubscriptions:et,isDeleting:ei,isUpdating:en,clearError:ea}=(0,q.P)(),[eo,el]=(0,i.useState)(""),[ec,ed]=(0,i.useState)(0),[ex,eu]=(0,i.useState)(10),[eh,ep]=(0,i.useState)(null),[ej,eZ]=(0,i.useState)(null),[em,eg]=(0,i.useState)(!1),[eb,ef]=(0,i.useState)(null),[ev,ey]=(0,i.useState)(!1),[eC,eS]=(0,i.useState)(null),[eD,ew]=(0,i.useState)(!1),[eP,eA]=(0,i.useState)(""),[ek,eI]=(0,i.useState)("success");(0,i.useEffect)(()=>{et()},[]);let eW=(e,s)=>{ep(e.currentTarget),eZ(s)},eE=()=>{ep(null),eZ(null)},ez=async()=>{if(ej)try{let e=await es(ej.id,"Suspended by administrator");e.success?(eN("Subscription suspended successfully","success"),et()):eN(e.error||"Failed to suspend subscription","error")}catch(e){eN("Failed to suspend subscription","error")}eE()},eL=async()=>{if(ej)try{let e=await er(ej.id);e.success?(eN("Subscription resumed successfully","success"),et()):eN(e.error||"Failed to resume subscription","error")}catch(e){eN("Failed to resume subscription","error")}eE()},eT=async()=>{if(eb)try{let e=await $(eb.id);e.success?(eN("Subscription deleted successfully","success"),et()):eN(e.error||"Failed to delete subscription","error")}catch(e){eN("Failed to delete subscription","error")}eg(!1),ef(null)},e_=()=>{eg(!1),ef(null)},eN=(e,s)=>{eA(e),eI(s),ew(!0)},eR=()=>{ew(!1)},eF=async(e,s)=>{try{let r=await ee(e,s);r.success?(eN("Subscription updated successfully","success"),ey(!1),eS(null),et()):eN(r.error||"Failed to update subscription","error")}catch(e){eN("Failed to update subscription","error")}},eO=(s||[]).filter(e=>{var s,r;return e.licenseKey.toLowerCase().includes(eo.toLowerCase())||e.tier.toLowerCase().includes(eo.toLowerCase())||(null===(s=e.customerName)||void 0===s?void 0:s.toLowerCase().includes(eo.toLowerCase()))||(null===(r=e.customerId)||void 0===r?void 0:r.toLowerCase().includes(eo.toLowerCase()))}),eB=eO.slice(ec*ex,ec*ex+ex),eU=e=>{switch(e){case"active":return"success";case"suspended":return"warning";case"expired":return"error";default:return"default"}},eK=e=>{switch(e){case"basic":default:return"#64748b";case"professional":return"#3b82f6";case"enterprise":return"#8b5cf6"}},eM=e=>new Date(e).toLocaleDateString(),eV=e=>{let s=new Date(e),r=new Date,t=Math.ceil((s.getTime()-r.getTime())/864e5);return t<=30&&t>0};return r?(0,t.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:(0,t.jsx)(o.Z,{size:48})}):(0,t.jsxs)(a.Z,{sx:{px:2,py:1},children:[(0,t.jsx)(l.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:ei||en,children:(0,t.jsx)(o.Z,{color:"inherit"})}),X&&(0,t.jsx)(c.Z,{severity:"error",sx:{mb:2},onClose:ea,children:X}),(0,t.jsxs)(a.Z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"h4",component:"h1",fontWeight:"bold",color:"primary",children:"Subscriptions"}),(0,t.jsx)(d.Z,{variant:"body1",color:"text.secondary",children:"Manage licenses and subscription plans"})]}),(0,t.jsx)(Q.default,{href:"/subscriptions/create",passHref:!0,children:(0,t.jsx)(x.Z,{variant:"contained",startIcon:(0,t.jsx)(N.Z,{}),sx:{borderRadius:2},children:"Create Subscription"})})]}),(0,t.jsx)(u.Z,{sx:{mb:3},children:(0,t.jsx)(h.Z,{children:(0,t.jsx)(a.Z,{sx:{display:"flex",gap:2,alignItems:"center"},children:(0,t.jsx)(p.Z,{placeholder:"Search subscriptions...",value:eo,onChange:e=>{el(e.target.value),ed(0)},sx:{flex:1},InputProps:{startAdornment:(0,t.jsx)(j.Z,{position:"start",children:(0,t.jsx)(R.Z,{})})}})})})}),(0,t.jsxs)(u.Z,{children:[(0,t.jsx)(Z.Z,{children:(0,t.jsxs)(m.Z,{children:[(0,t.jsx)(g.Z,{children:(0,t.jsxs)(b.Z,{children:[(0,t.jsx)(f.Z,{children:"Customer"}),(0,t.jsx)(f.Z,{children:"License Key"}),(0,t.jsx)(f.Z,{children:"Tier"}),(0,t.jsx)(f.Z,{children:"Status"}),(0,t.jsx)(f.Z,{children:"Devices"}),(0,t.jsx)(f.Z,{children:"Expires"}),(0,t.jsx)(f.Z,{children:"Revenue"}),(0,t.jsx)(f.Z,{align:"right",children:"Actions"})]})}),(0,t.jsx)(v.Z,{children:eB.map(e=>{var s;return(0,t.jsxs)(b.Z,{hover:!0,children:[(0,t.jsx)(f.Z,{children:(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,t.jsx)(y.Z,{sx:{bgcolor:"primary.main"},children:(null===(s=e.customerName)||void 0===s?void 0:s.charAt(0).toUpperCase())||"U"}),(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,children:e.customerName||"Unknown Customer"}),(0,t.jsx)(d.Z,{variant:"body2",color:"textSecondary",children:e.customerId})]})]})}),(0,t.jsx)(f.Z,{children:(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(F.Z,{sx:{fontSize:16,color:"text.secondary"}}),(0,t.jsx)(d.Z,{variant:"body2",sx:{fontFamily:"monospace"},children:e.licenseKey})]})}),(0,t.jsx)(f.Z,{children:(0,t.jsx)(C.Z,{label:e.tier.toUpperCase(),size:"small",sx:{bgcolor:eK(e.tier),color:"white",fontWeight:600}})}),(0,t.jsxs)(f.Z,{children:[(0,t.jsx)(C.Z,{label:e.status.toUpperCase(),size:"small",color:eU(e.status),variant:"filled"}),eV(e.expiresAt)&&(0,t.jsx)(C.Z,{label:"Expiring Soon",size:"small",color:"warning",variant:"outlined",sx:{ml:1}})]}),(0,t.jsx)(f.Z,{children:(0,t.jsxs)(a.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(O.Z,{sx:{fontSize:16,color:"text.secondary"}}),(0,t.jsxs)(d.Z,{variant:"body2",children:[e.devicesConnected||0,"/",e.maxDevices]}),(0,t.jsx)(S.Z,{variant:"determinate",value:(e.devicesConnected||0)/e.maxDevices*100,sx:{width:40,height:6,borderRadius:3,bgcolor:"#e2e8f0","& .MuiLinearProgress-bar":{bgcolor:e.devicesConnected===e.maxDevices?"#ef4444":"#10b981"}}})]})}),(0,t.jsx)(f.Z,{children:(0,t.jsx)(d.Z,{variant:"body2",color:"text.secondary",children:eM(e.expiresAt)})}),(0,t.jsx)(f.Z,{children:(0,t.jsx)(d.Z,{variant:"body2",fontWeight:600,children:(()=>{let s=0;switch(e.tier){case J.QV.BASIC:s=299;break;case J.QV.PROFESSIONAL:s=599;break;case J.QV.ENTERPRISE:s=1299;break;default:s=299}return"PKR ".concat(s.toLocaleString())})()})}),(0,t.jsx)(f.Z,{align:"right",children:(0,t.jsx)(D.Z,{onClick:s=>eW(s,e),children:(0,t.jsx)(B.Z,{})})})]},e.id)})})]})}),(0,t.jsx)(w.Z,{rowsPerPageOptions:[5,10,25],component:"div",count:eO.length,rowsPerPage:ex,page:ec,onPageChange:(e,s)=>{ed(s)},onRowsPerPageChange:e=>{eu(parseInt(e.target.value,10)),ed(0)}})]}),(0,t.jsxs)(P.Z,{anchorEl:eh,open:!!eh,onClose:eE,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[(0,t.jsxs)(A.Z,{onClick:()=>{ej&&e.push("/subscriptions/".concat(ej.id)),eE()},children:[(0,t.jsx)(k.Z,{children:(0,t.jsx)(U.Z,{fontSize:"small"})}),(0,t.jsx)(I.Z,{children:"View Details"})]}),(0,t.jsxs)(A.Z,{onClick:()=>{ej&&(eS(ej),ey(!0)),eE()},children:[(0,t.jsx)(k.Z,{children:(0,t.jsx)(K.Z,{fontSize:"small"})}),(0,t.jsx)(I.Z,{children:"Edit Subscription"})]}),(null==ej?void 0:ej.status)==="suspended"?(0,t.jsxs)(A.Z,{onClick:eL,children:[(0,t.jsx)(k.Z,{children:(0,t.jsx)(M.Z,{fontSize:"small"})}),(0,t.jsx)(I.Z,{children:"Resume"})]}):(0,t.jsxs)(A.Z,{onClick:ez,children:[(0,t.jsx)(k.Z,{children:(0,t.jsx)(V.Z,{fontSize:"small"})}),(0,t.jsx)(I.Z,{children:"Suspend"})]}),(0,t.jsxs)(A.Z,{onClick:()=>{ej&&(ef(ej),eg(!0)),eE()},sx:{color:"error.main"},children:[(0,t.jsx)(k.Z,{children:(0,t.jsx)(G.Z,{fontSize:"small",color:"error"})}),(0,t.jsx)(I.Z,{children:"Delete Subscription"})]})]}),(0,t.jsxs)(W.Z,{open:em,onClose:e_,maxWidth:"sm",fullWidth:!0,children:[(0,t.jsxs)(E.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(H.Z,{color:"error"}),"Confirm Delete Subscription"]}),(0,t.jsxs)(z.Z,{children:[(0,t.jsx)(L.Z,{children:"Are you sure you want to delete this subscription? This action cannot be undone."}),eb&&(0,t.jsxs)(a.Z,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,children:"Subscription Details:"}),(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:["Customer: ",eb.customerName]}),(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:["License Key: ",eb.licenseKey]}),(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:["Tier: ",eb.tier]}),(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:["Status: ",eb.status]})]})]}),(0,t.jsxs)(T.Z,{children:[(0,t.jsx)(x.Z,{onClick:e_,color:"primary",children:"Cancel"}),(0,t.jsx)(x.Z,{onClick:eT,color:"error",variant:"contained",disabled:ei,children:ei?"Deleting...":"Delete"})]})]}),(0,t.jsx)(Y,{open:ev,subscription:eC,onClose:()=>{ey(!1),eS(null)},onSubmit:eF,isUpdating:en}),(0,t.jsx)(_.Z,{open:eD,autoHideDuration:6e3,onClose:eR,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:(0,t.jsx)(c.Z,{onClose:eR,severity:ek,sx:{width:"100%"},children:eP})})]})}let Y=e=>{let{open:s,subscription:r,onClose:n,onSubmit:o,isUpdating:l}=e,[c,u]=(0,i.useState)({tier:"",features:[],maxDevices:1,expiresAt:"",gracePeriodDays:0,notes:""}),[h,j]=(0,i.useState)({});(0,i.useEffect)(()=>{r&&(u({tier:r.tier||"",features:r.features||[],maxDevices:r.maxDevices||1,expiresAt:r.expiresAt?new Date(r.expiresAt).toISOString().split("T")[0]:"",gracePeriodDays:r.gracePeriodDays||0,notes:r.notes||""}),j({}))},[r]);let Z=(e,s)=>{u(r=>({...r,[e]:s})),h[e]&&j(s=>({...s,[e]:""}))},m=e=>{u(s=>({...s,features:s.features.includes(e)?s.features.filter(s=>s!==e):[...s.features,e]}))},g=()=>{let e={};return(c.tier||(e.tier="Tier is required"),c.maxDevices<1&&(e.maxDevices="Max devices must be at least 1"),c.maxDevices>1e3&&(e.maxDevices="Max devices cannot exceed 1000"),c.expiresAt)?new Date(c.expiresAt)<=new Date&&(e.expiresAt="Expiration date must be in the future"):e.expiresAt="Expiration date is required",c.gracePeriodDays<0&&(e.gracePeriodDays="Grace period cannot be negative"),c.gracePeriodDays>365&&(e.gracePeriodDays="Grace period cannot exceed 365 days"),j(e),0===Object.keys(e).length},b=()=>{u({tier:"",features:[],maxDevices:1,expiresAt:"",gracePeriodDays:0,notes:""}),j({}),n()};return(0,t.jsxs)(W.Z,{open:s,onClose:b,maxWidth:"md",fullWidth:!0,children:[(0,t.jsxs)(E.Z,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,t.jsx)(K.Z,{color:"primary"}),"Edit Subscription"]}),(0,t.jsxs)(z.Z,{dividers:!0,children:[r&&(0,t.jsxs)(a.Z,{sx:{mb:3,p:2,bgcolor:"grey.50",borderRadius:1},children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Subscription Information"}),(0,t.jsxs)(a.Z,{sx:{display:"flex",gap:3},children:[(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:[(0,t.jsx)("strong",{children:"Customer:"})," ",r.customerName]}),(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:[(0,t.jsx)("strong",{children:"License Key:"})," ",r.licenseKey]}),(0,t.jsxs)(d.Z,{variant:"body2",color:"text.secondary",children:[(0,t.jsx)("strong",{children:"Status:"})," ",r.status]})]})]}),(0,t.jsxs)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Subscription Tier *"}),(0,t.jsx)(a.Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[{value:"basic",label:"Basic",color:"#64748b"},{value:"professional",label:"Professional",color:"#3b82f6"},{value:"enterprise",label:"Enterprise",color:"#8b5cf6"}].map(e=>(0,t.jsx)(x.Z,{variant:c.tier===e.value?"contained":"outlined",onClick:()=>Z("tier",e.value),sx:{...c.tier===e.value&&{bgcolor:e.color,"&:hover":{bgcolor:e.color}}},children:e.label},e.value))}),h.tier&&(0,t.jsx)(d.Z,{variant:"body2",color:"error",sx:{mt:1},children:h.tier})]}),(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Maximum Devices *"}),(0,t.jsx)(p.Z,{type:"number",value:c.maxDevices,onChange:e=>Z("maxDevices",parseInt(e.target.value)||1),error:!!h.maxDevices,helperText:h.maxDevices,inputProps:{min:1,max:1e3},sx:{width:"200px"}})]}),(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Expiration Date *"}),(0,t.jsx)(p.Z,{type:"date",value:c.expiresAt,onChange:e=>Z("expiresAt",e.target.value),error:!!h.expiresAt,helperText:h.expiresAt,sx:{width:"200px"}})]}),(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Grace Period (Days)"}),(0,t.jsx)(p.Z,{type:"number",value:c.gracePeriodDays,onChange:e=>Z("gracePeriodDays",parseInt(e.target.value)||0),error:!!h.gracePeriodDays,helperText:h.gracePeriodDays||"Number of days after expiration before subscription is cancelled",inputProps:{min:0,max:365},sx:{width:"200px"}})]}),(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Features"}),(0,t.jsx)(a.Z,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:["analytics","reporting","api_access","priority_support","custom_branding","advanced_security","bulk_operations","multi_tenant"].map(e=>(0,t.jsx)(C.Z,{label:e.replace("_"," ").toUpperCase(),clickable:!0,variant:c.features.includes(e)?"filled":"outlined",color:c.features.includes(e)?"primary":"default",onClick:()=>m(e),size:"small"},e))})]}),(0,t.jsxs)(a.Z,{children:[(0,t.jsx)(d.Z,{variant:"subtitle2",fontWeight:600,gutterBottom:!0,children:"Notes"}),(0,t.jsx)(p.Z,{multiline:!0,rows:3,value:c.notes,onChange:e=>Z("notes",e.target.value),placeholder:"Add any additional notes or comments...",fullWidth:!0})]})]})]}),(0,t.jsxs)(T.Z,{children:[(0,t.jsx)(x.Z,{onClick:b,color:"primary",children:"Cancel"}),(0,t.jsx)(x.Z,{onClick:()=>{if(!r||!g())return;let e={tier:c.tier,features:c.features,maxDevices:c.maxDevices,expiresAt:new Date(c.expiresAt),gracePeriodDays:c.gracePeriodDays,notes:c.notes||void 0};o(r.id,e)},color:"primary",variant:"contained",disabled:l,children:l?"Updating...":"Update Subscription"})]})]})}}},function(e){e.O(0,[355,152,160,425,735,593,404,617,841,754,788,246,886,971,117,744],function(){return e(e.s=49297)}),_N_E=e.O()}]);