(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[513],{76465:function(e,t,r){Promise.resolve().then(r.bind(r,31831))},31831:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return W}});var a=r(57437),s=r(2265),i=r(99376),n=r(1899),o=r(5002),l=r(94013),c=r(67208),d=r(36137),u=r(15735),p=r(89414),h=r(47678),x=r(97404),m=r(8350),f=r(67571),b=r(23996),v=r(42187),y=r(85860),j=r(14865),g=r(35389),Z=r(45319),_=r(44149),w=r(69651),P=r(74828),D=r(29541),S=r(70412),C=r(74853),I=r(57424),A=r(27648),k=r(69250),E=r(30797),T=r(46897),R=r(28223);let F=[{value:"trial",label:"Trial",features:["basic_analytics","core_features"],defaultPrice:0,defaultDevices:1,color:"#95A5A6"},{value:"basic",label:"Basic",features:["basic_analytics","core_features","email_support"],defaultPrice:99,defaultDevices:3,color:"#45B7D1"},{value:"professional",label:"Professional",features:["advanced_analytics","core_features","priority_support","api_access"],defaultPrice:299,defaultDevices:10,color:"#4ECDC4"},{value:"enterprise",label:"Enterprise",features:["advanced_analytics","core_features","dedicated_support","api_access","custom_integrations"],defaultPrice:999,defaultDevices:50,color:"#FF6B35"}],U=["core_features","basic_analytics","advanced_analytics","email_support","priority_support","dedicated_support","api_access","custom_integrations","white_labeling","multi_tenant"];function W(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)().get("customerId"),[r,W]=(0,s.useState)({customerId:t||"",customerName:"",tier:"basic",duration:365,maxDevices:3,price:99,currency:"USD",autoRenew:!1,gracePeriodDays:7,features:["basic_analytics","core_features","email_support"],notes:"",startsAt:new Date,expiresAt:new Date(Date.now()+31536e6)}),[B,O]=(0,s.useState)([]),[q,L]=(0,s.useState)(!1),[N,G]=(0,s.useState)(!1),[z,M]=(0,s.useState)(null),[H,J]=(0,s.useState)(null),[K,Q]=(0,s.useState)({}),V=async()=>{G(!0);try{let e=await fetch("http://localhost:8000/api/v1/subscription/customers");if(e.ok){let t=(await e.json()).items||[];O(t)}else console.error("Failed to fetch customers")}catch(e){console.error("Error fetching customers:",e)}finally{G(!1)}};(0,s.useEffect)(()=>{V()},[]),(0,s.useEffect)(()=>{if(t){let e=B.find(e=>e.id===t);e&&W(t=>({...t,customerId:e.id,customerName:e.name}))}},[t,B]),(0,s.useEffect)(()=>{let e=new Date(r.startsAt);e.setDate(e.getDate()+r.duration),W(t=>({...t,expiresAt:e}))},[r.startsAt,r.duration]);let X=()=>{let e={};return r.customerId||(e.customerId="Customer is required"),r.tier||(e.tier="Subscription tier is required"),r.duration<1&&(e.duration="Duration must be at least 1 day"),r.maxDevices<1&&(e.maxDevices="Max devices must be at least 1"),r.price<0&&(e.price="Price cannot be negative"),r.gracePeriodDays<0&&(e.gracePeriodDays="Grace period cannot be negative"),Q(e),0===Object.keys(e).length},Y=async t=>{if(t.preventDefault(),X()){L(!0),M(null),J(null);try{let t={customer_id:r.customerId,tier:r.tier,duration_days:parseInt(r.duration.toString()),max_devices:parseInt(r.maxDevices.toString()),price:parseFloat(r.price.toString())||null,currency:r.currency,auto_renew:r.autoRenew,grace_period_days:parseInt(r.gracePeriodDays.toString()),metadata:r.notes.trim()?{notes:r.notes.trim(),created_via:"dashboard",created_at:new Date().toISOString()}:null,custom_features:r.features.length>0?{enabled_features:r.features}:null};console.log("Sending subscription data:",t);let a=await R.x.post("/api/v1/subscription/subscriptions",t);a.success?(J("Subscription created successfully! License key has been generated."),setTimeout(()=>{e.push("/subscriptions")},3e3)):M(a.error||"Failed to create subscription")}catch(e){console.error("Subscription creation failed:",e),M(e instanceof Error?e.message:"An unexpected error occurred")}finally{L(!1)}}},$=e=>{let t=F.find(t=>t.value===e);t&&W(r=>({...r,tier:e,features:t.features,price:t.defaultPrice,maxDevices:t.defaultDevices}))},ee=e=>t=>{let r="number"===t.target.type?parseFloat(t.target.value)||0:t.target.value;W(t=>({...t,[e]:r})),K[e]&&Q(t=>({...t,[e]:""}))},et=B.find(e=>e.id===r.customerId);return(0,a.jsx)(k._,{dateAdapter:T.H,children:(0,a.jsxs)(n.Z,{sx:{px:2,py:1,maxWidth:900,mx:"auto"},children:[(0,a.jsxs)(n.Z,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(o.Z,{variant:"h4",component:"h1",sx:{fontWeight:700,color:"#1e293b"},children:"Create Subscription"}),(0,a.jsx)(o.Z,{variant:"body1",color:"textSecondary",children:"Generate a new subscription and license key for a customer"})]}),(0,a.jsx)(A.default,{href:"/subscriptions",style:{textDecoration:"none"},children:(0,a.jsx)(l.Z,{variant:"outlined",startIcon:(0,a.jsx)(Z.Z,{}),size:"large",sx:{borderRadius:2},children:"Back to Subscriptions"})})]}),(0,a.jsx)(c.Z,{elevation:3,children:(0,a.jsxs)(d.Z,{sx:{p:4},children:[H&&(0,a.jsx)(u.Z,{severity:"success",sx:{mb:3},children:H}),z&&(0,a.jsx)(u.Z,{severity:"error",sx:{mb:3},children:z}),(0,a.jsx)("form",{onSubmit:Y,children:(0,a.jsxs)(p.ZP,{container:!0,spacing:3,children:[(0,a.jsxs)(p.ZP,{item:!0,xs:12,children:[(0,a.jsxs)(o.Z,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(_.Z,{color:"primary"}),"Customer Information"]}),(0,a.jsx)(h.Z,{value:et||null,onChange:(e,t)=>{W(e=>({...e,customerId:(null==t?void 0:t.id)||"",customerName:(null==t?void 0:t.name)||""}))},options:B,getOptionLabel:e=>"".concat(e.name," (").concat(e.email,")"),renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Select Customer",error:!!K.customerId,helperText:K.customerId,required:!0}),renderOption:(e,t)=>(0,a.jsx)(n.Z,{component:"li",...e,children:(0,a.jsxs)(n.Z,{children:[(0,a.jsx)(o.Z,{variant:"body1",children:t.name}),(0,a.jsxs)(o.Z,{variant:"body2",color:"textSecondary",children:[t.email,t.company&&" â€¢ ".concat(t.company)]})]})}),disabled:q||N,fullWidth:!0}),(0,a.jsx)(m.Z,{sx:{my:2}})]}),(0,a.jsxs)(p.ZP,{item:!0,xs:12,children:[(0,a.jsxs)(o.Z,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[(0,a.jsx)(w.Z,{color:"primary"}),"Subscription Tier"]}),(0,a.jsx)(n.Z,{sx:{display:"flex",gap:1,mb:2,flexWrap:"wrap"},children:F.map(e=>(0,a.jsx)(f.Z,{label:e.label,clickable:!0,color:r.tier===e.value?"primary":"default",onClick:()=>$(e.value),sx:{borderColor:r.tier===e.value?void 0:e.color,color:r.tier===e.value?void 0:e.color}},e.value))}),(0,a.jsx)(m.Z,{sx:{my:2}})]}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(x.Z,{fullWidth:!0,label:"Duration (Days)",type:"number",value:r.duration,onChange:ee("duration"),error:!!K.duration,helperText:K.duration,disabled:q,required:!0,InputProps:{startAdornment:(0,a.jsx)(b.Z,{position:"start",children:(0,a.jsx)(P.Z,{color:"action"})})}})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(x.Z,{fullWidth:!0,label:"Max Devices",type:"number",value:r.maxDevices,onChange:ee("maxDevices"),error:!!K.maxDevices,helperText:K.maxDevices,disabled:q,required:!0,InputProps:{startAdornment:(0,a.jsx)(b.Z,{position:"start",children:(0,a.jsx)(D.Z,{color:"action"})})}})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(x.Z,{fullWidth:!0,label:"Price",type:"number",value:r.price,onChange:ee("price"),error:!!K.price,helperText:K.price,disabled:q,required:!0,InputProps:{startAdornment:(0,a.jsx)(b.Z,{position:"start",children:(0,a.jsx)(S.Z,{color:"action"})})}})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsxs)(x.Z,{fullWidth:!0,label:"Currency",select:!0,value:r.currency,onChange:ee("currency"),disabled:q,children:[(0,a.jsx)(v.Z,{value:"USD",children:"USD"}),(0,a.jsx)(v.Z,{value:"EUR",children:"EUR"}),(0,a.jsx)(v.Z,{value:"GBP",children:"GBP"})]})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(E.M,{label:"Start Date",value:r.startsAt,onChange:e=>{e&&W(t=>({...t,startsAt:e}))},disabled:q,slotProps:{textField:{fullWidth:!0,required:!0}}})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(E.M,{label:"Expires At",value:r.expiresAt,onChange:e=>{e&&W(t=>({...t,expiresAt:e}))},disabled:!0,slotProps:{textField:{fullWidth:!0,helperText:"Auto-calculated based on start date and duration"}}})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(x.Z,{fullWidth:!0,label:"Grace Period (Days)",type:"number",value:r.gracePeriodDays,onChange:ee("gracePeriodDays"),error:!!K.gracePeriodDays,helperText:K.gracePeriodDays,disabled:q})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:6,children:(0,a.jsx)(y.Z,{control:(0,a.jsx)(j.Z,{checked:r.autoRenew,onChange:e=>W(t=>({...t,autoRenew:e.target.checked})),disabled:q}),label:"Auto Renew",sx:{mt:2}})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,children:(0,a.jsx)(h.Z,{multiple:!0,value:r.features,onChange:(e,t)=>{W(e=>({...e,features:t}))},options:U,getOptionLabel:e=>e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),renderTags:(e,t)=>e.map((e,r)=>(0,a.jsx)(f.Z,{variant:"outlined",label:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),...t({index:r})})),renderInput:e=>(0,a.jsx)(x.Z,{...e,label:"Features",placeholder:"Select features..."}),disabled:q})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,children:(0,a.jsx)(x.Z,{fullWidth:!0,label:"Notes (Optional)",multiline:!0,rows:3,value:r.notes,onChange:ee("notes"),disabled:q,placeholder:"Additional information about this subscription..."})}),(0,a.jsxs)(p.ZP,{item:!0,xs:12,children:[(0,a.jsx)(m.Z,{sx:{my:2}}),(0,a.jsxs)(n.Z,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,a.jsx)(l.Z,{variant:"outlined",onClick:()=>{e.push("/subscriptions")},disabled:q,startIcon:(0,a.jsx)(C.Z,{}),children:"Cancel"}),(0,a.jsx)(l.Z,{type:"submit",variant:"contained",disabled:q,startIcon:q?(0,a.jsx)(g.Z,{size:20}):(0,a.jsx)(I.Z,{}),sx:{minWidth:160},children:q?"Creating...":"Generate License"})]})]})]})})]})})]})})}},28223:function(e,t,r){"use strict";r.d(t,{x:function(){return i}});let a=r(83464).Z.create({baseURL:"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});a.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),a.interceptors.response.use(e=>e,e=>{var t,r,a,s,i;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),window.location.href="/login"),(null===(r=e.response)||void 0===r?void 0:r.status)===403&&console.error("Permission denied"),(null===(a=e.response)||void 0===a?void 0:a.status)>=500&&console.error("Server error:",(null===(i=e.response)||void 0===i?void 0:null===(s=i.data)||void 0===s?void 0:s.message)||e.message),Promise.reject(e)});class s{async get(e,t){try{let r=await this.instance.get(e,t);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async post(e,t,r){try{let a=await this.instance.post(e,t,r);return{success:!0,data:a.data}}catch(e){return this.handleError(e)}}async put(e,t,r){try{let a=await this.instance.put(e,t,r);return{success:!0,data:a.data}}catch(e){return this.handleError(e)}}async patch(e,t,r){try{let a=await this.instance.patch(e,t,r);return{success:!0,data:a.data}}catch(e){return this.handleError(e)}}async delete(e,t){try{let r=await this.instance.delete(e,t);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}handleError(e){if(e.response){var t;return{success:!1,error:(null===(t=e.response.data)||void 0===t?void 0:t.message)||e.response.statusText}}return e.request?{success:!1,error:"Network error - please check your internet connection"}:{success:!1,error:e.message||"An unexpected error occurred"}}async uploadFile(e,t,r){let a=new FormData;a.append("file",t);try{let t=await this.instance.post(e,a,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(r&&e.total){let t=Math.round(100*e.loaded/e.total);r(t)}}});return{success:!0,data:t.data}}catch(e){return this.handleError(e)}}async downloadFile(e,t){try{let r=await this.instance.get(e,{responseType:"blob"}),a=new Blob([r.data]),s=document.createElement("a");s.href=window.URL.createObjectURL(a),s.download=t,s.click(),window.URL.revokeObjectURL(s.href)}catch(e){throw console.error("File download failed:",e),e}}setAuthToken(e){this.instance.defaults.headers.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.instance.defaults.headers.Authorization}constructor(){this.instance=a}}let i=new s}},function(e){e.O(0,[355,152,160,425,735,593,404,414,754,261,15,950,971,117,744],function(){return e(e.s=76465)}),_N_E=e.O()}]);