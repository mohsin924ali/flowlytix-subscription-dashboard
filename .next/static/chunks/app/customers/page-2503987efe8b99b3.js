(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{84626:function(e,t,s){Promise.resolve().then(s.bind(s,67949))},67949:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return B}});var r=s(57437),a=s(2265),n=s(99376),o=s(1899),i=s(35389),c=s(5002),l=s(94013),d=s(15735),u=s(67208),h=s(36137),m=s(97404),p=s(23996),x=s(22095),j=s(96207),Z=s(70208),y=s(32281),v=s(54301),g=s(61201),f=s(59469),b=s(67116),w=s(67571),C=s(59832),S=s(60407),_=s(57742),k=s(42187),A=s(53431),T=s(67051),z=s(44149),P=s(72549),E=s(29886),I=s(79335),L=s(91360),R=s(73381),O=s(5837),U=s(94395),D=s(54862),F=s(57424),N=s(27648),M=s(28223);function B(){let e=(0,n.useRouter)(),[t,s]=(0,a.useState)([]),[B,J]=(0,a.useState)(!0),[W,q]=(0,a.useState)(null),[H,Y]=(0,a.useState)(""),[V,X]=(0,a.useState)(0),[G,K]=(0,a.useState)(10),[Q,$]=(0,a.useState)(null),[ee,et]=(0,a.useState)(null),es=[{id:"550e8400-e29b-41d4-a716-446655440000",name:"John Doe",email:"john.doe@example.com",company:"Acme Corp",phone:"+1-555-123-4567",address:"123 Main St, New York, NY 10001",metadata:{customer_type:"business",notes:"Premium customer"},created_at:"2024-01-15T10:00:00Z",updated_at:"2024-01-15T10:00:00Z"},{id:"550e8400-e29b-41d4-a716-446655440001",name:"Jane Smith",email:"jane.smith@techstart.io",company:"TechStart",phone:"+1-555-987-6543",address:"456 Tech Ave, San Francisco, CA 94107",metadata:{customer_type:"business",notes:"Startup customer"},created_at:"2024-01-20T14:30:00Z",updated_at:"2024-01-20T14:30:00Z"},{id:"550e8400-e29b-41d4-a716-446655440002",name:"Michael Johnson",email:"michael.johnson@personal.com",phone:"+1-555-456-7890",address:"789 Home St, Austin, TX 73301",metadata:{customer_type:"individual",notes:"Individual user"},created_at:"2024-02-01T09:15:00Z",updated_at:"2024-02-01T09:15:00Z"}];(0,a.useEffect)(()=>{er()},[]);let er=async()=>{J(!0),q(null);try{let e=await M.x.get("/api/v1/subscription/customers");if(e.success&&e.data){let t=Array.isArray(e.data)?e.data:e.data.items||[];s(t)}else console.warn("API failed, using mock data:",e.error),s(es);J(!1)}catch(e){console.error("Failed to fetch customers:",e),s(es),J(!1)}},ea=(e,t)=>{$(e.currentTarget),et(t)},en=()=>{$(null),et(null)},eo=t.filter(e=>e.name.toLowerCase().includes(H.toLowerCase())||e.email.toLowerCase().includes(H.toLowerCase())||e.company&&e.company.toLowerCase().includes(H.toLowerCase())),ei=eo.slice(V*G,V*G+G),ec=e=>{switch(e){case"business":return"primary";case"individual":return"secondary";default:return"default"}},el=e=>"business"===e?(0,r.jsx)(z.Z,{}):(0,r.jsx)(P.Z,{});return B?(0,r.jsx)(o.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:(0,r.jsx)(i.Z,{size:48})}):(0,r.jsxs)(o.Z,{sx:{px:2,py:1},children:[(0,r.jsxs)(o.Z,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(c.Z,{variant:"h4",component:"h1",sx:{fontWeight:700,color:"#1e293b"},children:"Customers"}),(0,r.jsx)(c.Z,{variant:"body1",color:"textSecondary",children:"Manage your customer database and subscriptions"})]}),(0,r.jsx)(N.default,{href:"/customers/create",style:{textDecoration:"none"},children:(0,r.jsx)(l.Z,{variant:"contained",startIcon:(0,r.jsx)(E.Z,{}),size:"large",sx:{borderRadius:2},children:"Add Customer"})})]}),W&&(0,r.jsx)(d.Z,{severity:"error",sx:{mb:3},children:W}),(0,r.jsx)(u.Z,{sx:{mb:3},children:(0,r.jsx)(h.Z,{children:(0,r.jsx)(m.Z,{fullWidth:!0,placeholder:"Search customers by name, email, or company...",value:H,onChange:e=>{Y(e.target.value),X(0)},InputProps:{startAdornment:(0,r.jsx)(p.Z,{position:"start",children:(0,r.jsx)(I.Z,{color:"action"})})}})})}),(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(x.Z,{component:j.Z,children:(0,r.jsxs)(Z.Z,{children:[(0,r.jsx)(y.Z,{children:(0,r.jsxs)(v.Z,{children:[(0,r.jsx)(g.Z,{children:"Customer"}),(0,r.jsx)(g.Z,{children:"Type"}),(0,r.jsx)(g.Z,{children:"Contact"}),(0,r.jsx)(g.Z,{children:"Company"}),(0,r.jsx)(g.Z,{children:"Created"}),(0,r.jsx)(g.Z,{align:"right",children:"Actions"})]})}),(0,r.jsx)(f.Z,{children:ei.map(e=>{var t,s,a;return(0,r.jsxs)(v.Z,{hover:!0,children:[(0,r.jsx)(g.Z,{children:(0,r.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,r.jsx)(b.Z,{sx:{bgcolor:"primary.main"},children:e.name.charAt(0).toUpperCase()}),(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(c.Z,{variant:"subtitle2",fontWeight:600,children:e.name}),(0,r.jsx)(c.Z,{variant:"body2",color:"textSecondary",children:e.email})]})]})}),(0,r.jsx)(g.Z,{children:(0,r.jsx)(w.Z,{icon:el(null===(t=e.metadata)||void 0===t?void 0:t.customer_type),label:(null===(s=e.metadata)||void 0===s?void 0:s.customer_type)||"individual",color:ec(null===(a=e.metadata)||void 0===a?void 0:a.customer_type),size:"small",sx:{textTransform:"capitalize"}})}),(0,r.jsx)(g.Z,{children:(0,r.jsxs)(o.Z,{children:[(0,r.jsxs)(c.Z,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[(0,r.jsx)(L.Z,{fontSize:"small",color:"action"}),e.email]}),e.phone&&(0,r.jsxs)(c.Z,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,r.jsx)(R.Z,{fontSize:"small",color:"action"}),e.phone]})]})}),(0,r.jsx)(g.Z,{children:(0,r.jsx)(c.Z,{variant:"body2",children:e.company||"-"})}),(0,r.jsx)(g.Z,{children:(0,r.jsx)(c.Z,{variant:"body2",children:new Date(e.created_at).toLocaleDateString()})}),(0,r.jsx)(g.Z,{align:"right",children:(0,r.jsx)(C.Z,{onClick:t=>ea(t,e),size:"small",children:(0,r.jsx)(O.Z,{})})})]},e.id)})})]})}),(0,r.jsx)(S.Z,{rowsPerPageOptions:[5,10,25],component:"div",count:eo.length,rowsPerPage:G,page:V,onPageChange:(e,t)=>{X(t)},onRowsPerPageChange:e=>{K(parseInt(e.target.value,10)),X(0)}})]}),(0,r.jsxs)(_.Z,{anchorEl:Q,open:!!Q,onClose:en,transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[(0,r.jsxs)(k.Z,{onClick:()=>{ee&&e.push("/customers/".concat(ee.id)),en()},children:[(0,r.jsx)(A.Z,{children:(0,r.jsx)(U.Z,{fontSize:"small"})}),(0,r.jsx)(T.Z,{children:"View Details"})]}),(0,r.jsxs)(k.Z,{onClick:()=>{ee&&e.push("/customers/".concat(ee.id,"/edit")),en()},children:[(0,r.jsx)(A.Z,{children:(0,r.jsx)(D.Z,{fontSize:"small"})}),(0,r.jsx)(T.Z,{children:"Edit Customer"})]}),(0,r.jsxs)(k.Z,{onClick:()=>{ee&&e.push("/subscriptions/create?customerId=".concat(ee.id)),en()},children:[(0,r.jsx)(A.Z,{children:(0,r.jsx)(F.Z,{fontSize:"small"})}),(0,r.jsx)(T.Z,{children:"Create Subscription"})]})]})]})}},28223:function(e,t,s){"use strict";s.d(t,{x:function(){return n}});let r=s(83464).Z.create({baseURL:"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});r.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>{var t,s,r,a,n;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),window.location.href="/login"),(null===(s=e.response)||void 0===s?void 0:s.status)===403&&console.error("Permission denied"),(null===(r=e.response)||void 0===r?void 0:r.status)>=500&&console.error("Server error:",(null===(n=e.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:a.message)||e.message),Promise.reject(e)});class a{async get(e,t){try{let s=await this.instance.get(e,t);return{success:!0,data:s.data}}catch(e){return this.handleError(e)}}async post(e,t,s){try{let r=await this.instance.post(e,t,s);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async put(e,t,s){try{let r=await this.instance.put(e,t,s);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async patch(e,t,s){try{let r=await this.instance.patch(e,t,s);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async delete(e,t){try{let s=await this.instance.delete(e,t);return{success:!0,data:s.data}}catch(e){return this.handleError(e)}}handleError(e){if(e.response){var t;return{success:!1,error:(null===(t=e.response.data)||void 0===t?void 0:t.message)||e.response.statusText}}return e.request?{success:!1,error:"Network error - please check your internet connection"}:{success:!1,error:e.message||"An unexpected error occurred"}}async uploadFile(e,t,s){let r=new FormData;r.append("file",t);try{let t=await this.instance.post(e,r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(s&&e.total){let t=Math.round(100*e.loaded/e.total);s(t)}}});return{success:!0,data:t.data}}catch(e){return this.handleError(e)}}async downloadFile(e,t){try{let s=await this.instance.get(e,{responseType:"blob"}),r=new Blob([s.data]),a=document.createElement("a");a.href=window.URL.createObjectURL(r),a.download=t,a.click(),window.URL.revokeObjectURL(a.href)}catch(e){throw console.error("File download failed:",e),e}}setAuthToken(e){this.instance.defaults.headers.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.instance.defaults.headers.Authorization}constructor(){this.instance=r}}let n=new a}},function(e){e.O(0,[355,152,160,425,735,593,404,617,841,894,971,117,744],function(){return e(e.s=84626)}),_N_E=e.O()}]);