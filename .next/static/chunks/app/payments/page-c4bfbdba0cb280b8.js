(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[74],{12464:function(e,t,a){Promise.resolve().then(a.bind(a,68972))},68972:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eS}});var r=a(57437),s=a(2265),n=a(19978),l=a(1899),i=a(5002),o=a(15735),c=a(89414),d=a(67208),u=a(36137),p=a(19643),m=a(94013),h=a(35791),g=a(79507),y=a(77468),f=a(97404),x=a(41327),b=a(10020),v=a(33833),P=a(42187),j=a(9026),Z=a(8444),C=a(29886),k=a(30662),w=a(23478),S=a(29821),F=a(67571),D=a(35389),I=a(22095),A=a(96207),L=a(70208),R=a(32281),M=a(54301),U=a(61201),E=a(11953),_=a(39243),z=a(59469),T=a(89051),W=a(59832),N=a(57742),O=a(42581),B=a(54862),V=a(74853),q=a(77716),H=a(76672),X=a(5837),G=a(16210);(0,G.ZP)(F.Z,{shouldForwardProp:e=>"statusVariant"!==e})(e=>{let{theme:t,statusVariant:a}=e;return{fontWeight:600,fontSize:"0.75rem",height:"24px",textTransform:"uppercase",letterSpacing:"0.05em",...(()=>{switch(a){case"active":return{backgroundColor:t.palette.success.light,color:t.palette.success.dark,border:"1px solid ".concat(t.palette.success.main)};case"expired":case"inactive":return{backgroundColor:t.palette.error.light,color:t.palette.error.dark,border:"1px solid ".concat(t.palette.error.main)};case"suspended":return{backgroundColor:t.palette.warning.light,color:t.palette.warning.dark,border:"1px solid ".concat(t.palette.warning.main)};case"cancelled":case"revoked":default:return{backgroundColor:t.palette.grey[100],color:t.palette.grey[700],border:"1px solid ".concat(t.palette.grey[400])};case"pending":return{backgroundColor:t.palette.info.light,color:t.palette.info.dark,border:"1px solid ".concat(t.palette.info.main)}}})()}});var K=a(51195),J=a(89706),Y=a(80524),Q=a(71524),$=a(50074);let ee=(0,G.ZP)(F.Z,{shouldForwardProp:e=>"paymentStatus"!==e})(e=>{let{theme:t,paymentStatus:a}=e;return{fontWeight:600,fontSize:"0.75rem",height:"24px",textTransform:"uppercase",letterSpacing:"0.05em",...(()=>{switch(a){case"completed":return{backgroundColor:t.palette.success.light,color:t.palette.success.dark,border:"1px solid ".concat(t.palette.success.main)};case"pending":case"processing":return{backgroundColor:t.palette.info.light,color:t.palette.info.dark,border:"1px solid ".concat(t.palette.info.main)};case"failed":case"expired":return{backgroundColor:t.palette.error.light,color:t.palette.error.dark,border:"1px solid ".concat(t.palette.error.main)};case"cancelled":default:return{backgroundColor:t.palette.grey[100],color:t.palette.grey[700],border:"1px solid ".concat(t.palette.grey[400])};case"refunded":case"partially_refunded":return{backgroundColor:t.palette.warning.light,color:t.palette.warning.dark,border:"1px solid ".concat(t.palette.warning.main)}}})()}}),et={pending:"Pending",processing:"Processing",completed:"Completed",failed:"Failed",cancelled:"Cancelled",refunded:"Refunded",partially_refunded:"Partial Refund",expired:"Expired"},ea={pending:K.Z,processing:w.Z,completed:S.Z,failed:J.Z,cancelled:V.Z,refunded:Y.Z,partially_refunded:Q.Z,expired:$.Z},er=e=>{let{status:t,showIcon:a=!1,"data-testid":s,...n}=e,l=et[t]||t,i=ea[t],o=a&&i?{icon:(0,r.jsx)(i,{})}:{};return(0,r.jsx)(ee,{label:l,paymentStatus:t,size:"small","data-testid":s||"payment-status-chip-".concat(t),...o,...n})},es=(0,G.ZP)(i.Z,{shouldForwardProp:e=>"amountSize"!==e&&"colorVariant"!==e})(e=>{let{theme:t,amountSize:a,colorVariant:r}=e;return{fontFamily:"monospace",letterSpacing:"0.05em",...(()=>{switch(a){case"small":return{fontSize:"0.875rem",fontWeight:500};case"medium":default:return{fontSize:"1rem",fontWeight:600};case"large":return{fontSize:"1.25rem",fontWeight:700}}})(),...(()=>{switch(r){case"success":return{color:t.palette.success.main};case"error":return{color:t.palette.error.main};case"warning":return{color:t.palette.warning.main};case"info":return{color:t.palette.info.main};case"muted":return{color:t.palette.text.secondary};default:return{color:t.palette.text.primary}}})()}}),en=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PKR",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return new Intl.NumberFormat("PKR"===t?"en-PK":"en-US",{style:"currency",currency:t,minimumFractionDigits:a,maximumFractionDigits:a}).format(e)},el=e=>{let{amount:t,currency:a="PKR",size:s="medium",colorVariant:n="default",showSign:l=!1,precision:i=2,"data-testid":o,...c}=e,d=en(t,a,i);return(0,r.jsx)(es,{amountSize:s,colorVariant:n,"data-testid":o||"amount-display",...c,children:l&&t>0?"+".concat(d):d})},ei=[{id:"id",label:"Payment ID",sortable:!0,width:"120px",render:e=>(0,r.jsxs)(i.Z,{variant:"body2",fontFamily:"monospace",children:[e.id.slice(0,8),"..."]})},{id:"subscriptionId",label:"Subscription",sortable:!0,width:"120px",render:e=>(0,r.jsxs)(i.Z,{variant:"body2",fontFamily:"monospace",children:[e.subscriptionId.slice(0,8),"..."]})},{id:"amount",label:"Amount",sortable:!0,width:"120px",align:"right",render:e=>(0,r.jsx)(el,{amount:e.amount,currency:e.currency,size:"small",colorVariant:"completed"===e.status?"success":"default"})},{id:"status",label:"Status",sortable:!0,width:"120px",align:"center",render:e=>(0,r.jsx)(er,{status:e.status,showIcon:!0})},{id:"paymentMethod",label:"Method",sortable:!0,width:"120px",render:e=>(0,r.jsx)(F.Z,{label:e.paymentMethod.replace("_"," ").toUpperCase(),size:"small",variant:"outlined"})},{id:"paymentType",label:"Type",sortable:!0,width:"100px",render:e=>(0,r.jsx)(F.Z,{label:e.paymentType.toUpperCase(),size:"small",variant:"outlined",color:"primary"})},{id:"createdAt",label:"Created",sortable:!0,width:"140px",render:e=>(0,r.jsx)(i.Z,{variant:"body2",children:new Date(e.createdAt).toLocaleDateString()})},{id:"processedAt",label:"Processed",sortable:!0,width:"140px",render:e=>(0,r.jsx)(i.Z,{variant:"body2",children:e.processedAt?new Date(e.processedAt).toLocaleDateString():"-"})}],eo=e=>{let{payments:t,loading:a=!1,selectable:n=!1,selectedPayments:o=[],onSelectionChange:c,onPaymentAction:d,onSort:u,sortField:p,sortDirection:m="asc","data-testid":h}=e,[g,y]=(0,s.useState)(null),[f,x]=(0,s.useState)(null),b=(e,t)=>{y(e.currentTarget),x(t)},v=()=>{y(null),x(null)},j=e=>{f&&d&&d(f,e),v()},Z=e=>{c&&(o.includes(e)?c(o.filter(t=>t!==e)):c([...o,e]))},C=e=>{u&&u(e,p===e&&"asc"===m?"desc":"asc")},k=e=>{let t=["view","history"];return"pending"===e.status?t.push("edit","process","fail"):"completed"===e.status?t.push("refund"):"failed"===e.status&&t.push("edit"),t.push("delete"),t},F=(0,s.useMemo)(()=>{if(!f)return[];let e=t.find(e=>e.id===f);if(!e)return[];let a=k(e);return[{action:"view",label:"View Details",icon:(0,r.jsx)(O.Z,{})},{action:"edit",label:"Edit Payment",icon:(0,r.jsx)(B.Z,{})},{action:"process",label:"Process Payment",icon:(0,r.jsx)(S.Z,{})},{action:"fail",label:"Mark as Failed",icon:(0,r.jsx)(V.Z,{})},{action:"refund",label:"Refund Payment",icon:(0,r.jsx)(w.Z,{})},{action:"history",label:"View History",icon:(0,r.jsx)(q.Z,{})},{action:"delete",label:"Delete Payment",icon:(0,r.jsx)(H.Z,{})}].filter(e=>a.includes(e.action))},[f,t]),G=n&&t.length>0&&o.length===t.length,K=n&&o.length>0&&o.length<t.length;return a?(0,r.jsx)(l.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"200px",children:(0,r.jsx)(D.Z,{})}):(0,r.jsxs)(I.Z,{component:A.Z,"data-testid":h,children:[(0,r.jsxs)(L.Z,{size:"small",stickyHeader:!0,children:[(0,r.jsx)(R.Z,{children:(0,r.jsxs)(M.Z,{children:[n&&(0,r.jsx)(U.Z,{padding:"checkbox",children:(0,r.jsx)(E.Z,{checked:G,indeterminate:K,onChange:e=>{c&&(e.target.checked?c(t.map(e=>e.id)):c([]))}})}),ei.map(e=>(0,r.jsx)(U.Z,{align:e.align||"left",style:{width:e.width},children:e.sortable?(0,r.jsx)(_.Z,{active:p===e.id,direction:p===e.id?m:"asc",onClick:()=>C(e.id),children:e.label}):e.label},e.id)),(0,r.jsx)(U.Z,{align:"center",width:"60px",children:"Actions"})]})}),(0,r.jsx)(z.Z,{children:0===t.length?(0,r.jsx)(M.Z,{children:(0,r.jsx)(U.Z,{colSpan:ei.length+(n?1:0)+1,align:"center",sx:{py:4},children:(0,r.jsx)(i.Z,{variant:"body2",color:"text.secondary",children:"No payments found"})})}):t.map(e=>(0,r.jsxs)(M.Z,{hover:!0,selected:o.includes(e.id),children:[n&&(0,r.jsx)(U.Z,{padding:"checkbox",children:(0,r.jsx)(E.Z,{checked:o.includes(e.id),onChange:()=>Z(e.id)})}),ei.map(t=>(0,r.jsx)(U.Z,{align:t.align||"left",children:t.render?t.render(e):String(e[t.id]||"")},t.id)),(0,r.jsx)(U.Z,{align:"center",children:(0,r.jsx)(T.Z,{title:"More actions",children:(0,r.jsx)(W.Z,{size:"small",onClick:t=>b(t,e.id),children:(0,r.jsx)(X.Z,{})})})})]},e.id))})]}),(0,r.jsx)(N.Z,{anchorEl:g,open:!!g,onClose:v,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:F.map(e=>(0,r.jsx)(P.Z,{onClick:()=>j(e.action),children:(0,r.jsxs)(l.Z,{display:"flex",alignItems:"center",gap:1,children:[e.icon,e.label]})},e.action))})]})};var ec=a(27485),ed=a(96369),eu=a(44164),ep=a(52700),em=a(92798),eh=a(97470),eg=a(30797),ey=a(69250),ef=a(46897);let ex=[{value:"pending",label:"Pending"},{value:"processing",label:"Processing"},{value:"completed",label:"Completed"},{value:"failed",label:"Failed"},{value:"cancelled",label:"Cancelled"},{value:"refunded",label:"Refunded"},{value:"partially_refunded",label:"Partially Refunded"},{value:"expired",label:"Expired"}],eb=[{value:"manual",label:"Manual"},{value:"bank_transfer",label:"Bank Transfer"},{value:"credit_card",label:"Credit Card"},{value:"debit_card",label:"Debit Card"},{value:"paypal",label:"PayPal"},{value:"stripe",label:"Stripe"},{value:"cash",label:"Cash"},{value:"check",label:"Check"},{value:"wire_transfer",label:"Wire Transfer"},{value:"cryptocurrency",label:"Cryptocurrency"},{value:"other",label:"Other"}],ev=[{value:"subscription",label:"Subscription"},{value:"renewal",label:"Renewal"},{value:"upgrade",label:"Upgrade"},{value:"refund",label:"Refund"}],eP=e=>{let{filters:t,onFiltersChange:a,onClearFilters:n,loading:o=!1,"data-testid":u}=e,[h,g]=(0,s.useState)(!1),y=(0,s.useCallback)((e,r)=>{a({...t,[e]:r})},[t,a]),j=(0,s.useCallback)((e,a)=>{let r=t[e]||[],s=r.includes(a)?r.filter(e=>e!==a):[...r,a];y(e,s.length>0?s:void 0)},[t,y]),Z=(0,s.useCallback)(()=>{var e,a,r;let s=0;return(null===(e=t.status)||void 0===e?void 0:e.length)&&s++,(null===(a=t.paymentMethod)||void 0===a?void 0:a.length)&&s++,(null===(r=t.paymentType)||void 0===r?void 0:r.length)&&s++,t.subscriptionId&&s++,t.adminUserId&&s++,t.startDate&&s++,t.endDate&&s++,void 0!==t.minAmount&&s++,void 0!==t.maxAmount&&s++,t.currency&&s++,s},[t])();return(0,r.jsx)(ey._,{dateAdapter:ef.H,children:(0,r.jsx)(d.Z,{"data-testid":u,children:(0,r.jsxs)(ec.Z,{expanded:h,onChange:(e,t)=>g(t),children:[(0,r.jsx)(ed.Z,{expandIcon:(0,r.jsx)(ep.Z,{}),children:(0,r.jsxs)(l.Z,{display:"flex",alignItems:"center",gap:1,width:"100%",children:[(0,r.jsx)(em.Z,{}),(0,r.jsx)(i.Z,{variant:"h6",children:"Filters"}),Z>0&&(0,r.jsx)(F.Z,{label:"".concat(Z," active"),size:"small",color:"primary",variant:"outlined"}),(0,r.jsx)(l.Z,{flexGrow:1}),Z>0&&(0,r.jsx)(m.Z,{size:"small",startIcon:(0,r.jsx)(eh.Z,{}),onClick:e=>{e.stopPropagation(),n()},disabled:o,children:"Clear All"})]})}),(0,r.jsx)(eu.Z,{children:(0,r.jsxs)(c.ZP,{container:!0,spacing:3,children:[(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,lg:4,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Status"}),(0,r.jsx)(p.Z,{direction:"row",flexWrap:"wrap",gap:1,children:ex.map(e=>{var a,s;return(0,r.jsx)(F.Z,{label:e.label,clickable:!0,variant:(null===(a=t.status)||void 0===a?void 0:a.includes(e.value))?"filled":"outlined",color:(null===(s=t.status)||void 0===s?void 0:s.includes(e.value))?"primary":"default",onClick:()=>j("status",e.value),size:"small"},e.value)})})]}),(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,lg:4,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Payment Method"}),(0,r.jsx)(p.Z,{direction:"row",flexWrap:"wrap",gap:1,children:eb.slice(0,6).map(e=>{var a,s;return(0,r.jsx)(F.Z,{label:e.label,clickable:!0,variant:(null===(a=t.paymentMethod)||void 0===a?void 0:a.includes(e.value))?"filled":"outlined",color:(null===(s=t.paymentMethod)||void 0===s?void 0:s.includes(e.value))?"primary":"default",onClick:()=>j("paymentMethod",e.value),size:"small"},e.value)})})]}),(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,lg:4,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Payment Type"}),(0,r.jsx)(p.Z,{direction:"row",flexWrap:"wrap",gap:1,children:ev.map(e=>{var a,s;return(0,r.jsx)(F.Z,{label:e.label,clickable:!0,variant:(null===(a=t.paymentType)||void 0===a?void 0:a.includes(e.value))?"filled":"outlined",color:(null===(s=t.paymentType)||void 0===s?void 0:s.includes(e.value))?"primary":"default",onClick:()=>j("paymentType",e.value),size:"small"},e.value)})})]}),(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Date Range"}),(0,r.jsxs)(p.Z,{direction:"row",spacing:2,children:[(0,r.jsx)(eg.M,{label:"Start Date",value:t.startDate||null,onChange:e=>y("startDate",e),slotProps:{textField:{size:"small",fullWidth:!0}}}),(0,r.jsx)(eg.M,{label:"End Date",value:t.endDate||null,onChange:e=>y("endDate",e),slotProps:{textField:{size:"small",fullWidth:!0}}})]})]}),(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Amount Range"}),(0,r.jsxs)(p.Z,{direction:"row",spacing:2,children:[(0,r.jsx)(f.Z,{label:"Min Amount",type:"number",size:"small",value:t.minAmount||"",onChange:e=>y("minAmount",e.target.value?Number(e.target.value):void 0),fullWidth:!0}),(0,r.jsx)(f.Z,{label:"Max Amount",type:"number",size:"small",value:t.maxAmount||"",onChange:e=>y("maxAmount",e.target.value?Number(e.target.value):void 0),fullWidth:!0})]})]}),(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Search"}),(0,r.jsxs)(p.Z,{spacing:2,children:[(0,r.jsx)(f.Z,{label:"Subscription ID",size:"small",value:t.subscriptionId||"",onChange:e=>y("subscriptionId",e.target.value||void 0),placeholder:"Enter subscription ID...",fullWidth:!0}),(0,r.jsx)(f.Z,{label:"Admin User ID",size:"small",value:t.adminUserId||"",onChange:e=>y("adminUserId",e.target.value||void 0),placeholder:"Enter admin user ID...",fullWidth:!0})]})]}),(0,r.jsxs)(c.ZP,{item:!0,xs:12,md:6,children:[(0,r.jsx)(i.Z,{variant:"subtitle2",gutterBottom:!0,children:"Currency"}),(0,r.jsxs)(x.Z,{size:"small",fullWidth:!0,children:[(0,r.jsx)(b.Z,{children:"Currency"}),(0,r.jsxs)(v.Z,{value:t.currency||"",label:"Currency",onChange:e=>y("currency",e.target.value||void 0),children:[(0,r.jsx)(P.Z,{value:"",children:"All Currencies"}),(0,r.jsx)(P.Z,{value:"USD",children:"USD"}),(0,r.jsx)(P.Z,{value:"EUR",children:"EUR"}),(0,r.jsx)(P.Z,{value:"GBP",children:"GBP"}),(0,r.jsx)(P.Z,{value:"CAD",children:"CAD"}),(0,r.jsx)(P.Z,{value:"AUD",children:"AUD"})]})]})]})]})})]})})})};a(98734),a(94599),a(30482);var ej=a(28223);class eZ{async createPayment(e){return ej.x.post("/api/v1/payments",e)}async getPayment(e){return ej.x.get("/api/v1/payments/".concat(e))}async searchPayments(e,t,a){let r={...e,limit:t,offset:a};return ej.x.post("/api/v1/payments/search",r)}async getSubscriptionPayments(e,t,a){let r=new URLSearchParams;return t&&r.append("limit",t.toString()),a&&r.append("offset",a.toString()),ej.x.get("/api/v1/payments/subscription/".concat(e,"?").concat(r.toString()))}async getPendingPayments(e,t){let a=new URLSearchParams;return e&&a.append("limit",e.toString()),t&&a.append("offset",t.toString()),ej.x.get("/api/v1/payments/pending?".concat(a.toString()))}async getFailedPayments(e,t){let a=new URLSearchParams;return e&&a.append("limit",e.toString()),t&&a.append("offset",t.toString()),ej.x.get("/api/v1/payments/failed?".concat(a.toString()))}async processPayment(e,t){return ej.x.post("/api/v1/payments/".concat(e,"/process"),t)}async failPayment(e,t){return ej.x.post("/api/v1/payments/".concat(e,"/fail"),t)}async refundPayment(e,t){return ej.x.post("/api/v1/payments/".concat(e,"/refund"),t)}async addPaymentNote(e,t){return ej.x.post("/api/v1/payments/".concat(e,"/notes"),t)}async bulkPaymentAction(e){return ej.x.post("/api/v1/payments/bulk-action",e)}async getPaymentAnalytics(e,t){let a=new URLSearchParams;return e&&a.append("start_date",e.toISOString()),t&&a.append("end_date",t.toISOString()),ej.x.get("/api/v1/payments/analytics?".concat(a.toString()))}async getRevenueByPeriod(e,t,a){let r=new URLSearchParams;return r.append("period",e),t&&r.append("start_date",t.toISOString()),a&&r.append("end_date",a.toISOString()),ej.x.get("/api/v1/payments/analytics/revenue?".concat(r.toString()))}async getPaymentMethodStats(){return ej.x.get("/api/v1/payments/analytics/methods")}async getPaymentHistory(e,t,a){let r=new URLSearchParams;return t&&r.append("limit",t.toString()),a&&r.append("offset",a.toString()),ej.x.get("/api/v1/payments/".concat(e,"/history?").concat(r.toString()))}async getAdminActivity(e,t,a,r,s){let n=new URLSearchParams;return t&&n.append("start_date",t.toISOString()),a&&n.append("end_date",a.toISOString()),r&&n.append("limit",r.toString()),s&&n.append("offset",s.toString()),ej.x.get("/api/v1/payments/admin/".concat(e,"/activity?").concat(n.toString()))}getPaymentStatusSummary(e){let t={total:e.length,byStatus:{},byMethod:{},totalAmount:0,completedAmount:0};return e.forEach(e=>{t.byStatus[e.status]=(t.byStatus[e.status]||0)+1,t.byMethod[e.paymentMethod]=(t.byMethod[e.paymentMethod]||0)+1,t.totalAmount+=e.amount,"completed"===e.status&&(t.completedAmount+=e.amount)}),t}formatAmount(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"USD";return new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e)}getStatusColor(e){return({pending:"#fbbf24",processing:"#3b82f6",completed:"#10b981",failed:"#ef4444",cancelled:"#6b7280",refunded:"#8b5cf6",partially_refunded:"#f59e0b",expired:"#9ca3af"})[e]||"#6b7280"}getMethodDisplayName(e){return({manual:"Manual",bank_transfer:"Bank Transfer",credit_card:"Credit Card",debit_card:"Debit Card",paypal:"PayPal",stripe:"Stripe",cash:"Cash",check:"Check",wire_transfer:"Wire Transfer",cryptocurrency:"Cryptocurrency",other:"Other"})[e]||e}getTypeDisplayName(e){return({subscription:"Subscription",renewal:"Renewal",upgrade:"Upgrade",refund:"Refund"})[e]||e}canProcessPayment(e){return"pending"===e.status||"failed"===e.status}canRefundPayment(e){return"completed"===e.status&&"refund"!==e.paymentType}canFailPayment(e){return"pending"===e.status||"processing"===e.status}validatePaymentForm(e){let t=[];return e.subscriptionId||t.push("Subscription ID is required"),(!e.amount||e.amount<=0)&&t.push("Amount must be greater than 0"),e.currency&&3===e.currency.length||t.push("Valid currency code is required"),e.paymentMethod||t.push("Payment method is required"),e.paymentType||t.push("Payment type is required"),{isValid:0===t.length,errors:t}}calculatePaymentStats(e){let t=e.filter(e=>"completed"===e.status).reduce((e,t)=>e+t.amount,0),a=e.length>0?e.reduce((e,t)=>e+t.amount,0)/e.length:0,r=e.filter(e=>"completed"===e.status).length,s=e.length>0?r/e.length*100:0;return{totalRevenue:t,averageAmount:a,successRate:s,pendingCount:e.filter(e=>"pending"===e.status).length,failedCount:e.filter(e=>"failed"===e.status).length,refundedCount:e.filter(e=>"refunded"===e.status).length}}filterPaymentsByDate(e,t,a){return e.filter(e=>{let r=new Date(e.createdAt);return r>=t&&r<=a})}groupPaymentsByPeriod(e,t){let a={};return e.forEach(e=>{let r;let s=new Date(e.createdAt);switch(t){case"day":default:r=s.toISOString().split("T")[0];break;case"week":let n=new Date(s);n.setDate(s.getDate()-s.getDay()),r=n.toISOString().split("T")[0];break;case"month":r="".concat(s.getFullYear(),"-").concat(String(s.getMonth()+1).padStart(2,"0"));break;case"year":r=s.getFullYear().toString()}a[r]||(a[r]=[]),a[r].push(e)}),a}exportPaymentsToCSV(e){return[["ID","Subscription ID","Amount","Currency","Payment Method","Payment Type","Status","Reference ID","Description","Created At","Processed At","Admin User ID"],...e.map(e=>[e.id,e.subscriptionId,e.amount.toString(),e.currency,this.getMethodDisplayName(e.paymentMethod),this.getTypeDisplayName(e.paymentType),e.status,e.referenceId||"",e.description||"",new Date(e.createdAt).toISOString(),e.processedAt?new Date(e.processedAt).toISOString():"",e.adminUserId||""])].map(e=>e.map(e=>'"'.concat(e,'"')).join(",")).join("\n")}downloadPaymentsCSV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"payments.csv",a=new Blob([this.exportPaymentsToCSV(e)],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(void 0!==r.download){let e=URL.createObjectURL(a);r.setAttribute("href",e),r.setAttribute("download",t),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}}let eC=new eZ,ek=e=>{let t=(0,s.useRef)(eC).current,[a,r]=(0,s.useState)({payments:[],selectedPayment:null,totalCount:0,currentPage:1,pageSize:10,filters:e||{},analytics:null,stats:null,isLoading:!1,isFetching:!1,isCreating:!1,isUpdating:!1,isDeleting:!1,isProcessing:!1,error:null,hasMore:!1}),n=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=1===e?"isLoading":"isFetching";r(e=>({...e,[n]:!0,error:null,...s&&{payments:[],currentPage:1}}));try{let l=await t.searchPayments(a.filters,e,a.pageSize);if(l.success&&l.data){let t=l.data,i=1===e||s?t.payments:[...a.payments,...t.payments],o=e<Math.ceil(t.total/(t.limit||10));r(a=>({...a,payments:i,totalCount:t.total,currentPage:e,hasMore:o,[n]:!1,error:null}))}else r(e=>({...e,[n]:!1,error:l.error||"Failed to fetch payments"}))}catch(e){r(t=>({...t,[n]:!1,error:e instanceof Error?e.message:"Failed to fetch payments"}))}},[eC,a.filters,a.pageSize,a.payments]),l=(0,s.useCallback)(async()=>{a.hasMore&&!a.isFetching&&await n(a.currentPage+1)},[n,a.hasMore,a.isFetching,a.currentPage]),i=(0,s.useCallback)(async()=>{await n(1,!0)},[n]),o=(0,s.useCallback)(async e=>{try{let a=await t.getPayment(e);if(a.success&&a.data)return{success:!0,data:a.data};return{success:!1,error:a.error||"Failed to fetch payment"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to fetch payment"}}},[eC]),c=(0,s.useCallback)(async e=>{r(e=>({...e,isCreating:!0,error:null}));try{let a=await t.createPayment(e);if(a.success&&a.data)return r(e=>({...e,payments:[a.data,...e.payments],totalCount:e.totalCount+1,isCreating:!1,error:null})),{success:!0,data:a.data};return r(e=>({...e,isCreating:!1,error:a.error||"Failed to create payment"})),{success:!1,error:a.error||"Failed to create payment"}}catch(t){let e=t instanceof Error?t.message:"Failed to create payment";return r(t=>({...t,isCreating:!1,error:e})),{success:!1,error:e}}},[eC]),d=(0,s.useCallback)(async(e,a)=>{r(e=>({...e,isUpdating:!0,error:null}));try{let s=await t.updatePayment(e,a);if(s.success&&s.data)return r(t=>{var a;return{...t,payments:t.payments.map(t=>t.id===e?s.data:t),selectedPayment:(null===(a=t.selectedPayment)||void 0===a?void 0:a.id)===e?s.data:t.selectedPayment,isUpdating:!1,error:null}}),{success:!0,data:s.data};return r(e=>({...e,isUpdating:!1,error:s.error||"Failed to update payment"})),{success:!1,error:s.error||"Failed to update payment"}}catch(t){let e=t instanceof Error?t.message:"Failed to update payment";return r(t=>({...t,isUpdating:!1,error:e})),{success:!1,error:e}}},[eC]),u=(0,s.useCallback)(async e=>{r(e=>({...e,isDeleting:!0,error:null}));try{let a=await t.deletePayment(e);if(a.success)return r(t=>{var a;return{...t,payments:t.payments.filter(t=>t.id!==e),selectedPayment:(null===(a=t.selectedPayment)||void 0===a?void 0:a.id)===e?null:t.selectedPayment,totalCount:t.totalCount-1,isDeleting:!1,error:null}}),{success:!0};return r(e=>({...e,isDeleting:!1,error:a.error||"Failed to delete payment"})),{success:!1,error:a.error||"Failed to delete payment"}}catch(t){let e=t instanceof Error?t.message:"Failed to delete payment";return r(t=>({...t,isDeleting:!1,error:e})),{success:!1,error:e}}},[eC]),p=(0,s.useCallback)(async(e,a)=>{r(e=>({...e,isProcessing:!0,error:null}));try{let s=await t.processPayment(e,a);if(s.success&&s.data)return r(t=>{var a;return{...t,payments:t.payments.map(t=>t.id===e?s.data:t),selectedPayment:(null===(a=t.selectedPayment)||void 0===a?void 0:a.id)===e?s.data:t.selectedPayment,isProcessing:!1,error:null}}),{success:!0,data:s.data};return r(e=>({...e,isProcessing:!1,error:s.error||"Failed to process payment"})),{success:!1,error:s.error||"Failed to process payment"}}catch(t){let e=t instanceof Error?t.message:"Failed to process payment";return r(t=>({...t,isProcessing:!1,error:e})),{success:!1,error:e}}},[eC]),m=(0,s.useCallback)(async(e,a)=>{r(e=>({...e,isProcessing:!0,error:null}));try{let s=await t.failPayment(e,a);if(s.success&&s.data)return r(t=>{var a;return{...t,payments:t.payments.map(t=>t.id===e?s.data:t),selectedPayment:(null===(a=t.selectedPayment)||void 0===a?void 0:a.id)===e?s.data:t.selectedPayment,isProcessing:!1,error:null}}),{success:!0,data:s.data};return r(e=>({...e,isProcessing:!1,error:s.error||"Failed to fail payment"})),{success:!1,error:s.error||"Failed to fail payment"}}catch(t){let e=t instanceof Error?t.message:"Failed to fail payment";return r(t=>({...t,isProcessing:!1,error:e})),{success:!1,error:e}}},[eC]),h=(0,s.useCallback)(async(e,a,s)=>{r(e=>({...e,isProcessing:!0,error:null}));try{let n=await t.refundPayment(e,a,s);if(n.success&&n.data)return r(t=>{var a;return{...t,payments:t.payments.map(t=>t.id===e?n.data:t),selectedPayment:(null===(a=t.selectedPayment)||void 0===a?void 0:a.id)===e?n.data:t.selectedPayment,isProcessing:!1,error:null}}),{success:!0,data:n.data};return r(e=>({...e,isProcessing:!1,error:n.error||"Failed to refund payment"})),{success:!1,error:n.error||"Failed to refund payment"}}catch(t){let e=t instanceof Error?t.message:"Failed to refund payment";return r(t=>({...t,isProcessing:!1,error:e})),{success:!1,error:e}}},[eC]),g=(0,s.useCallback)(async(e,a)=>{r(e=>({...e,isUpdating:!0,error:null}));try{let s=await t.bulkUpdatePayments(e,a);if(s.success)return await n(1,!0),r(e=>({...e,isUpdating:!1,error:null})),{success:!0,data:s.data};return r(e=>({...e,isUpdating:!1,error:s.error||"Failed to bulk update payments"})),{success:!1,error:s.error||"Failed to bulk update payments"}}catch(t){let e=t instanceof Error?t.message:"Failed to bulk update payments";return r(t=>({...t,isUpdating:!1,error:e})),{success:!1,error:e}}},[eC,n]),y=(0,s.useCallback)(async e=>{r(e=>({...e,isProcessing:!0,error:null}));try{let a=await t.bulkProcessPayments(e);if(a.success)return await n(1,!0),r(e=>({...e,isProcessing:!1,error:null})),{success:!0,data:a.data};return r(e=>({...e,isProcessing:!1,error:a.error||"Failed to bulk process payments"})),{success:!1,error:a.error||"Failed to bulk process payments"}}catch(t){let e=t instanceof Error?t.message:"Failed to bulk process payments";return r(t=>({...t,isProcessing:!1,error:e})),{success:!1,error:e}}},[eC,n]),f=(0,s.useCallback)(async(e,a)=>{try{let s=await t.getAnalytics(e,a);if(s.success&&s.data)return r(e=>({...e,analytics:s.data,error:null})),{success:!0,data:s.data};return r(e=>({...e,error:s.error||"Failed to fetch analytics"})),{success:!1,error:s.error||"Failed to fetch analytics"}}catch(t){let e=t instanceof Error?t.message:"Failed to fetch analytics";return r(t=>({...t,error:e})),{success:!1,error:e}}},[eC]),x=(0,s.useCallback)(async()=>{try{let e=await t.getStats();if(e.success&&e.data)return r(t=>({...t,stats:e.data,error:null})),{success:!0,data:e.data};return r(t=>({...t,error:e.error||"Failed to fetch stats"})),{success:!1,error:e.error||"Failed to fetch stats"}}catch(t){let e=t instanceof Error?t.message:"Failed to fetch stats";return r(t=>({...t,error:e})),{success:!1,error:e}}},[eC]),b=(0,s.useCallback)(e=>{r(t=>({...t,filters:{...t.filters,...e}}))},[]),v=(0,s.useCallback)(()=>{r(e=>({...e,filters:{}}))},[]),P=(0,s.useCallback)(e=>{r(t=>({...t,selectedPayment:e}))},[]),j=(0,s.useCallback)(async()=>{try{let e=await t.exportPayments(a.filters);if(e.success)return{success:!0};return r(t=>({...t,error:e.error||"Failed to export payments"})),{success:!1,error:e.error||"Failed to export payments"}}catch(t){let e=t instanceof Error?t.message:"Failed to export payments";return r(t=>({...t,error:e})),{success:!1,error:e}}},[eC,a.filters]),Z=(0,s.useCallback)(()=>{r(e=>({...e,error:null}))},[]);return(0,s.useEffect)(()=>{n(1,!0)},[a.filters]),(0,s.useEffect)(()=>{x()},[x]),{payments:a.payments,selectedPayment:a.selectedPayment,totalCount:a.totalCount,currentPage:a.currentPage,pageSize:a.pageSize,filters:a.filters,analytics:a.analytics,stats:a.stats,isLoading:a.isLoading,isFetching:a.isFetching,isCreating:a.isCreating,isUpdating:a.isUpdating,isDeleting:a.isDeleting,isProcessing:a.isProcessing,error:a.error,hasMore:a.hasMore,fetchPayments:n,loadMore:l,refetch:i,getPayment:o,createPayment:c,updatePayment:d,deletePayment:u,processPayment:p,failPayment:m,refundPayment:h,bulkUpdatePayments:g,bulkProcessPayments:y,fetchAnalytics:f,fetchStats:x,setFilters:b,clearFilters:v,setSelectedPayment:P,exportPayments:j,clearError:Z}};var ew=a(6481);function eS(){var e,t;let{payments:a,totalCount:F,isLoading:D,isProcessing:I,error:A,filters:L,stats:R,fetchPayments:M,processPayment:U,failPayment:E,refundPayment:_,createPayment:z,bulkProcessPayments:T,setFilters:W,clearFilters:N,exportPayments:O,clearError:B}=ek(),[V,q]=(0,s.useState)({selectedPayments:[],showCreateDialog:!1,showProcessDialog:!1,showFailDialog:!1,showRefundDialog:!1,processingPaymentId:null,snackbar:{open:!1,message:"",severity:"info"}}),[H,X]=(0,s.useState)({paymentMethod:ew.XL.MANUAL,paymentType:ew.uG.SUBSCRIPTION,currency:"USD"}),[G,K]=(0,s.useState)(""),[J,Y]=(0,s.useState)(""),[Q,$]=(0,s.useState)("");(0,s.useEffect)(()=>{M()},[M]);let ee=(0,s.useCallback)((e,t)=>{q(a=>({...a,snackbar:{open:!0,message:e,severity:t}}))},[]),et=(0,s.useCallback)(async(e,t)=>{switch(q(t=>({...t,processingPaymentId:e})),t){case"process":q(e=>({...e,showProcessDialog:!0}));break;case"fail":q(e=>({...e,showFailDialog:!0}));break;case"refund":q(e=>({...e,showRefundDialog:!0}));break;case"view":ee("Payment details view - Coming soon","info");break;case"edit":ee("Payment editing - Coming soon","info");break;case"delete":ee("Payment deletion - Coming soon","info");break;case"history":ee("Payment history view - Coming soon","info");break;default:ee("Unknown action: ".concat(t),"warning")}},[ee]),ea=(0,s.useCallback)(async()=>{if(V.processingPaymentId)try{let e=await U(V.processingPaymentId,G);e.success?(ee("Payment processed successfully","success"),q(e=>({...e,showProcessDialog:!1,processingPaymentId:null})),K("")):ee(e.error||"Failed to process payment","error")}catch(e){ee("Failed to process payment","error")}},[V.processingPaymentId,G,U,ee]),er=(0,s.useCallback)(async()=>{if(V.processingPaymentId&&J.trim())try{let e=await E(V.processingPaymentId,J);e.success?(ee("Payment marked as failed","success"),q(e=>({...e,showFailDialog:!1,processingPaymentId:null})),Y("")):ee(e.error||"Failed to mark payment as failed","error")}catch(e){ee("Failed to mark payment as failed","error")}},[V.processingPaymentId,J,E,ee]),es=(0,s.useCallback)(async()=>{if(V.processingPaymentId)try{let e=await _(V.processingPaymentId,void 0,Q);e.success?(ee("Payment refunded successfully","success"),q(e=>({...e,showRefundDialog:!1,processingPaymentId:null})),$("")):ee(e.error||"Failed to refund payment","error")}catch(e){ee("Failed to refund payment","error")}},[V.processingPaymentId,Q,_,ee]),en=(0,s.useCallback)(async()=>{if(H.subscriptionId&&H.amount)try{let e=await z(H);e.success?(ee("Payment created successfully","success"),q(e=>({...e,showCreateDialog:!1})),X({paymentMethod:ew.XL.MANUAL,paymentType:ew.uG.SUBSCRIPTION,currency:"USD"})):ee(e.error||"Failed to create payment","error")}catch(e){ee("Failed to create payment","error")}},[H,z,ee]),ei=(0,s.useCallback)(async()=>{if(0!==V.selectedPayments.length)try{let t=await T(V.selectedPayments);if(t.success){var e;ee("Processed ".concat((null===(e=t.data)||void 0===e?void 0:e.processed)||0," payments"),"success"),q(e=>({...e,selectedPayments:[]}))}else ee(t.error||"Failed to process payments","error")}catch(e){ee("Failed to process payments","error")}},[V.selectedPayments,T,ee]),ec=(0,s.useCallback)(async()=>{try{let e=await O();e.success?ee("Payments exported successfully","success"):ee(e.error||"Failed to export payments","error")}catch(e){ee("Failed to export payments","error")}},[O,ee]);return(0,r.jsxs)(n.Z,{maxWidth:"xl",sx:{py:3},children:[(0,r.jsxs)(l.Z,{mb:3,children:[(0,r.jsx)(i.Z,{variant:"h4",component:"h1",gutterBottom:!0,children:"Payment Management"}),(0,r.jsx)(i.Z,{variant:"body1",color:"text.secondary",children:"Manage subscription payments, process manual payments, and track payment history"})]}),A&&(0,r.jsx)(o.Z,{severity:"error",sx:{mb:3},onClose:B,children:A}),R&&(0,r.jsxs)(c.ZP,{container:!0,spacing:3,sx:{mb:3},children:[(0,r.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(d.Z,{children:(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(i.Z,{variant:"h6",color:"primary",children:"Total Payments"}),(0,r.jsx)(i.Z,{variant:"h4",children:R.totalPayments})]})})}),(0,r.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(d.Z,{children:(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(i.Z,{variant:"h6",color:"success.main",children:"Total Revenue"}),(0,r.jsx)(el,{amount:R.totalRevenue,currency:"USD",size:"large",colorVariant:"success"})]})})}),(0,r.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(d.Z,{children:(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(i.Z,{variant:"h6",color:"info.main",children:"Pending Payments"}),(0,r.jsx)(i.Z,{variant:"h4",children:(null==R?void 0:null===(e=R.statusBreakdown)||void 0===e?void 0:e.pending)||0})]})})}),(0,r.jsx)(c.ZP,{item:!0,xs:12,sm:6,md:3,children:(0,r.jsx)(d.Z,{children:(0,r.jsxs)(u.Z,{children:[(0,r.jsx)(i.Z,{variant:"h6",color:"warning.main",children:"Failed Payments"}),(0,r.jsx)(i.Z,{variant:"h4",children:(null==R?void 0:null===(t=R.statusBreakdown)||void 0===t?void 0:t.failed)||0})]})})})]}),(0,r.jsx)(d.Z,{sx:{mb:3},children:(0,r.jsx)(u.Z,{children:(0,r.jsxs)(p.Z,{direction:"row",spacing:2,alignItems:"center",flexWrap:"wrap",children:[(0,r.jsx)(m.Z,{variant:"contained",startIcon:(0,r.jsx)(C.Z,{}),onClick:()=>q(e=>({...e,showCreateDialog:!0})),children:"Create Payment"}),(0,r.jsx)(m.Z,{variant:"outlined",startIcon:(0,r.jsx)(k.Z,{}),onClick:ec,disabled:D,children:"Export"}),(0,r.jsx)(m.Z,{variant:"outlined",startIcon:(0,r.jsx)(w.Z,{}),onClick:()=>M(1,!0),disabled:D,children:"Refresh"}),V.selectedPayments.length>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(m.Z,{variant:"outlined",startIcon:(0,r.jsx)(S.Z,{}),onClick:ei,disabled:I,color:"success",children:["Process Selected (",V.selectedPayments.length,")"]})})]})})}),(0,r.jsx)(l.Z,{mb:3,children:(0,r.jsx)(eP,{filters:L,onFiltersChange:W,onClearFilters:N,loading:D})}),(0,r.jsx)(d.Z,{children:(0,r.jsx)(eo,{payments:a,loading:D,selectable:!0,selectedPayments:V.selectedPayments,onSelectionChange:e=>q(t=>({...t,selectedPayments:e})),onPaymentAction:et})}),(0,r.jsxs)(h.Z,{open:V.showCreateDialog,onClose:()=>q(e=>({...e,showCreateDialog:!1})),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(g.Z,{children:"Create New Payment"}),(0,r.jsx)(y.Z,{children:(0,r.jsxs)(p.Z,{spacing:3,sx:{mt:1},children:[(0,r.jsx)(f.Z,{label:"Subscription ID",value:H.subscriptionId||"",onChange:e=>X(t=>({...t,subscriptionId:e.target.value})),fullWidth:!0,required:!0}),(0,r.jsx)(f.Z,{label:"Amount",type:"number",value:H.amount||"",onChange:e=>X(t=>({...t,amount:Number(e.target.value)})),fullWidth:!0,required:!0}),(0,r.jsxs)(x.Z,{fullWidth:!0,children:[(0,r.jsx)(b.Z,{children:"Payment Method"}),(0,r.jsxs)(v.Z,{value:H.paymentMethod||ew.XL.MANUAL,label:"Payment Method",onChange:e=>X(t=>({...t,paymentMethod:e.target.value})),children:[(0,r.jsx)(P.Z,{value:ew.XL.MANUAL,children:"Manual"}),(0,r.jsx)(P.Z,{value:ew.XL.BANK_TRANSFER,children:"Bank Transfer"}),(0,r.jsx)(P.Z,{value:ew.XL.CREDIT_CARD,children:"Credit Card"}),(0,r.jsx)(P.Z,{value:ew.XL.CASH,children:"Cash"})]})]}),(0,r.jsx)(f.Z,{label:"Description",value:H.description||"",onChange:e=>X(t=>({...t,description:e.target.value})),fullWidth:!0,multiline:!0,rows:2})]})}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(m.Z,{onClick:()=>q(e=>({...e,showCreateDialog:!1})),children:"Cancel"}),(0,r.jsx)(m.Z,{onClick:en,variant:"contained",disabled:!H.subscriptionId||!H.amount,children:"Create Payment"})]})]}),(0,r.jsxs)(h.Z,{open:V.showProcessDialog,onClose:()=>q(e=>({...e,showProcessDialog:!1})),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(g.Z,{children:"Process Payment"}),(0,r.jsx)(y.Z,{children:(0,r.jsx)(f.Z,{label:"Processing Notes (Optional)",value:G,onChange:e=>K(e.target.value),fullWidth:!0,multiline:!0,rows:3,sx:{mt:1}})}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(m.Z,{onClick:()=>q(e=>({...e,showProcessDialog:!1})),children:"Cancel"}),(0,r.jsx)(m.Z,{onClick:ea,variant:"contained",color:"success",disabled:I,children:"Process Payment"})]})]}),(0,r.jsxs)(h.Z,{open:V.showFailDialog,onClose:()=>q(e=>({...e,showFailDialog:!1})),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(g.Z,{children:"Mark Payment as Failed"}),(0,r.jsx)(y.Z,{children:(0,r.jsx)(f.Z,{label:"Failure Reason",value:J,onChange:e=>Y(e.target.value),fullWidth:!0,multiline:!0,rows:3,required:!0,sx:{mt:1}})}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(m.Z,{onClick:()=>q(e=>({...e,showFailDialog:!1})),children:"Cancel"}),(0,r.jsx)(m.Z,{onClick:er,variant:"contained",color:"error",disabled:I||!J.trim(),children:"Mark as Failed"})]})]}),(0,r.jsxs)(h.Z,{open:V.showRefundDialog,onClose:()=>q(e=>({...e,showRefundDialog:!1})),maxWidth:"sm",fullWidth:!0,children:[(0,r.jsx)(g.Z,{children:"Refund Payment"}),(0,r.jsx)(y.Z,{children:(0,r.jsx)(f.Z,{label:"Refund Reason (Optional)",value:Q,onChange:e=>$(e.target.value),fullWidth:!0,multiline:!0,rows:3,sx:{mt:1}})}),(0,r.jsxs)(j.Z,{children:[(0,r.jsx)(m.Z,{onClick:()=>q(e=>({...e,showRefundDialog:!1})),children:"Cancel"}),(0,r.jsx)(m.Z,{onClick:es,variant:"contained",color:"warning",disabled:I,children:"Process Refund"})]})]}),(0,r.jsx)(Z.Z,{open:V.snackbar.open,autoHideDuration:6e3,onClose:()=>q(e=>({...e,snackbar:{...e.snackbar,open:!1}})),children:(0,r.jsx)(o.Z,{severity:V.snackbar.severity,onClose:()=>q(e=>({...e,snackbar:{...e.snackbar,open:!1}})),children:V.snackbar.message})})]})}},98734:function(e,t,a){"use strict";a.d(t,{a:function(){return n}});var r=a(2265),s=a(28223);let n=()=>{let[e,t]=(0,r.useState)({user:null,token:null,isAuthenticated:!1,isLoading:!1,isInitializing:!0,error:null}),a=(0,r.useCallback)(async()=>{try{let e=localStorage.getItem("auth_token"),a=localStorage.getItem("auth_user");if(e&&a){let r=JSON.parse(a);t(t=>({...t,user:r,token:e,isAuthenticated:!0,isInitializing:!1}))}else t(e=>({...e,isInitializing:!1}))}catch(e){localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),t(e=>({...e,isInitializing:!1,error:"Authentication verification failed"}))}},[]),n=(0,r.useCallback)(async e=>{t(e=>({...e,isLoading:!0,error:null}));try{let a=await s.x.post("/api/v1/auth/login",e);if(!a.success||!a.data)return t(e=>({...e,isLoading:!1,error:a.error||"Login failed"})),{success:!1,error:a.error||"Login failed"};{let{user:e,token:r}=a.data;return localStorage.setItem("auth_token",r),localStorage.setItem("auth_user",JSON.stringify(e)),t(t=>({...t,user:e,token:r,isAuthenticated:!0,isLoading:!1,error:null})),{success:!0}}}catch(a){let e=a instanceof Error?a.message:"Login failed";return t(t=>({...t,isLoading:!1,error:e})),{success:!1,error:e}}},[]),l=(0,r.useCallback)(async e=>{t(e=>({...e,isLoading:!0,error:null}));try{let a=await s.x.post("/api/v1/auth/register",e);if(!a.success||!a.data)return t(e=>({...e,isLoading:!1,error:a.error||"Registration failed"})),{success:!1,error:a.error||"Registration failed"};{let{user:e,token:r}=a.data;return localStorage.setItem("auth_token",r),localStorage.setItem("auth_user",JSON.stringify(e)),t(t=>({...t,user:e,token:r,isAuthenticated:!0,isLoading:!1,error:null})),{success:!0}}}catch(a){let e=a instanceof Error?a.message:"Registration failed";return t(t=>({...t,isLoading:!1,error:e})),{success:!1,error:e}}},[]),i=(0,r.useCallback)(async()=>{t(e=>({...e,isLoading:!0}));try{await s.x.post("/api/v1/auth/logout")}catch(e){console.warn("Logout API call failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),t({user:null,token:null,isAuthenticated:!1,isLoading:!1,isInitializing:!1,error:null})}},[]),o=(0,r.useCallback)(async()=>{try{let e=await s.x.post("/api/v1/auth/refresh");if(!e.success||!e.data)return{success:!1,error:e.error||"Token refresh failed"};{let{token:a}=e.data;return localStorage.setItem("auth_token",a),t(e=>({...e,token:a,error:null})),{success:!0}}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Token refresh failed"}}},[]),c=(0,r.useCallback)(()=>{t(e=>({...e,error:null}))},[]),d=(0,r.useCallback)(async e=>{t(e=>({...e,isLoading:!0,error:null}));try{let a=await s.x.patch("/api/v1/auth/profile",e);if(!a.success||!a.data)return t(e=>({...e,isLoading:!1,error:a.error||"Profile update failed"})),{success:!1,error:a.error||"Profile update failed"};{let e=a.data;return localStorage.setItem("auth_user",JSON.stringify(e)),t(t=>({...t,user:e,isLoading:!1,error:null})),{success:!0}}}catch(a){let e=a instanceof Error?a.message:"Profile update failed";return t(t=>({...t,isLoading:!1,error:e})),{success:!1,error:e}}},[]),u=(0,r.useCallback)(async(e,a)=>{t(e=>({...e,isLoading:!0,error:null}));try{let r=await s.x.post("/api/v1/auth/change-password",{currentPassword:e,newPassword:a});if(r.success)return t(e=>({...e,isLoading:!1,error:null})),{success:!0};return t(e=>({...e,isLoading:!1,error:r.error||"Password change failed"})),{success:!1,error:r.error||"Password change failed"}}catch(a){let e=a instanceof Error?a.message:"Password change failed";return t(t=>({...t,isLoading:!1,error:e})),{success:!1,error:e}}},[]),p=(0,r.useCallback)(async e=>{t(e=>({...e,isLoading:!0,error:null}));try{let a=await s.x.post("/api/v1/auth/reset-password",{email:e});if(a.success)return t(e=>({...e,isLoading:!1,error:null})),{success:!0};return t(e=>({...e,isLoading:!1,error:a.error||"Password reset failed"})),{success:!1,error:a.error||"Password reset failed"}}catch(a){let e=a instanceof Error?a.message:"Password reset failed";return t(t=>({...t,isLoading:!1,error:e})),{success:!1,error:e}}},[]),m=(0,r.useCallback)(t=>{var a,r;return(null===(r=e.user)||void 0===r?void 0:null===(a=r.permissions)||void 0===a?void 0:a.includes(t))||!1},[e.user]),h=(0,r.useCallback)(t=>{var a;return(null===(a=e.user)||void 0===a?void 0:a.role)===t},[e.user]);return(0,r.useEffect)(()=>{a()},[a]),{...e,login:n,register:l,logout:i,refreshToken:o,clearError:c,updateProfile:d,changePassword:u,resetPassword:p,checkPermission:m,hasRole:h}}}},function(e){e.O(0,[355,152,425,735,593,404,414,617,754,261,15,788,631,886,482,971,117,744],function(){return e(e.s=12464)}),_N_E=e.O()}]);