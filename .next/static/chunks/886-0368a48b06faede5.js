"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[886],{94599:function(e,t,s){s.d(t,{P:function(){return i}});var r=s(2265),a=s(28223);class c{transformSubscription(e){var t,s,r,a;let c=(null===(t=e.customer)||void 0===t?void 0:t.name)||e.customer_name||"Unknown Customer";return{id:e.id,customerName:c,customerId:e.customer_id,customer:e.customer?{id:e.customer.id,name:e.customer.name,email:e.customer.email,phone:e.customer.phone||void 0,company:e.customer.company||void 0,address:e.customer.address||void 0,createdAt:new Date(e.customer.created_at),updatedAt:new Date(e.customer.updated_at)}:void 0,licenseKey:e.license_key,tier:e.tier,status:e.status,features:(null===(s=e.features)||void 0===s?void 0:s.enabled_features)||[],maxDevices:e.max_devices,devicesConnected:(null===(r=e.devices)||void 0===r?void 0:r.length)||0,startsAt:new Date(e.starts_at),expiresAt:new Date(e.expires_at),gracePeriodDays:e.grace_period_days||0,lastActivity:new Date(e.updated_at),lastSyncAt:new Date(e.updated_at),notes:(null===(a=e.metadata)||void 0===a?void 0:a.notes)||"",createdAt:new Date(e.created_at),updatedAt:new Date(e.updated_at)}}async getSubscriptions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=new URLSearchParams;r.append("limit",s.toString()),r.append("offset",((t-1)*s).toString()),e&&(e.status&&e.status.length>0&&e.status.forEach(e=>r.append("status",e)),e.tier&&e.tier.length>0&&e.tier.forEach(e=>r.append("tier",e)),e.search&&r.append("search",e.search),e.customerId&&r.append("customer_id",e.customerId),e.startDate&&r.append("start_date",e.startDate.toISOString()),e.endDate&&r.append("end_date",e.endDate.toISOString()));let c="".concat(this.baseUrl,"?").concat(r.toString()),i=await a.x.get(c);if(i.success&&i.data){let e=i.data,r=Math.ceil(e.total/s);return{success:!0,data:{data:(e.items||[]).map(e=>this.transformSubscription(e)),totalCount:e.total||0,page:t,pageSize:s,totalPages:r}}}return i}async getSubscription(e){let t=await a.x.get("".concat(this.baseUrl,"/").concat(e));return t.success&&t.data?{success:!0,data:this.transformSubscription(t.data)}:t}async createSubscription(e){let t=await a.x.post(this.baseUrl,e);return t.success&&t.data?{success:!0,data:this.transformSubscription(t.data)}:t}async updateSubscription(e,t){try{let s={};void 0!==t.tier&&(s.tier=t.tier),void 0!==t.features&&(Array.isArray(t.features)&&0===t.features.length?s.custom_features={}:Array.isArray(t.features)?s.custom_features=t.features.reduce((e,t)=>(e[t]=!0,e),{}):s.custom_features=t.features),void 0!==t.maxDevices&&(s.max_devices=t.maxDevices),void 0!==t.expiresAt&&(s.expires_at=t.expiresAt),void 0!==t.gracePeriodDays&&(s.grace_period_days=t.gracePeriodDays),void 0!==t.notes&&(s.notes=t.notes);let r=await a.x.put("".concat(this.baseUrl,"/").concat(e),s);if(r.success&&r.data)return{success:!0,data:this.transformSubscription(r.data)};return r}catch(e){return console.error("Update subscription error:",e),{success:!1,error:e instanceof Error?e.message:"Update failed"}}}async deleteSubscription(e){return a.x.delete("".concat(this.baseUrl,"/").concat(e))}async suspendSubscription(e,t){let s=await a.x.put("".concat(this.baseUrl,"/").concat(e,"/suspend"),{reason:t});return s.success&&s.data?{success:!0,data:this.transformSubscription(s.data)}:s}async resumeSubscription(e){let t=await a.x.put("".concat(this.baseUrl,"/").concat(e,"/resume"));return t.success&&t.data?{success:!0,data:this.transformSubscription(t.data)}:t}async cancelSubscription(e,t){let s=await a.x.put("".concat(this.baseUrl,"/").concat(e,"/cancel"),{reason:t});return s.success&&s.data?{success:!0,data:this.transformSubscription(s.data)}:s}async renewSubscription(e,t){let s=await a.x.post("".concat(this.baseUrl,"/").concat(e,"/renew"),{expires_at:t.toISOString()});return s.success&&s.data?{success:!0,data:this.transformSubscription(s.data)}:s}async getSubscriptionAnalytics(e,t){let s=new URLSearchParams;e&&s.append("start_date",e.toISOString()),t&&s.append("end_date",t.toISOString());let r="".concat(this.baseUrl,"/analytics?").concat(s.toString());return a.x.get(r)}async getSubscriptionUsage(e){return a.x.get("".concat(this.baseUrl,"/").concat(e,"/usage"))}async getSubscriptionDevices(e){return a.x.get("".concat(this.baseUrl,"/").concat(e,"/devices"))}async revokeDeviceAccess(e,t){return a.x.delete("".concat(this.baseUrl,"/").concat(e,"/devices/").concat(t))}async exportSubscriptions(e){let t=new URLSearchParams;e&&(e.status&&e.status.length>0&&e.status.forEach(e=>t.append("status",e)),e.tier&&e.tier.length>0&&e.tier.forEach(e=>t.append("tier",e)),e.search&&t.append("search",e.search),e.customerId&&t.append("customer_id",e.customerId),e.startDate&&t.append("start_date",e.startDate.toISOString()),e.endDate&&t.append("end_date",e.endDate.toISOString()));let s="".concat(this.baseUrl,"/export?").concat(t.toString()),r="subscriptions_".concat(new Date().toISOString().split("T")[0],".csv");await a.x.downloadFile(s,r)}async validateLicenseKey(e){return a.x.post("/api/v1/licensing/validate-key",{license_key:e})}async generateLicenseKey(e){return a.x.post("".concat(this.baseUrl,"/").concat(e,"/generate-key"))}async getSubscriptionActivity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=new URLSearchParams;r.append("page",t.toString()),r.append("page_size",s.toString());let c="".concat(this.baseUrl,"/").concat(e,"/activity?").concat(r.toString());return a.x.get(c)}async bulkUpdateSubscriptions(e,t){return a.x.post("".concat(this.baseUrl,"/bulk-update"),{subscription_ids:e,updates:t})}async getHealthCheck(){return a.x.get("/api/v1/health")}constructor(){this.baseUrl="/api/v1/subscription/subscriptions"}}new c;let i=e=>{let t=(0,r.useRef)(new c).current,[s,a]=(0,r.useState)({subscriptions:[],selectedSubscription:null,totalCount:0,currentPage:1,pageSize:10,filters:e||{},isLoading:!1,isFetching:!1,isCreating:!1,isUpdating:!1,isDeleting:!1,error:null,hasMore:!1}),i=(0,r.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=1===e?"isLoading":"isFetching";a(e=>({...e,[c]:!0,error:null,...r&&{subscriptions:[],currentPage:1}}));try{let i=await t.getSubscriptions(s.filters,e,s.pageSize);if(i.success&&i.data){let t=i.data,n=1===e||r?t.data:[...s.subscriptions,...t.data],o=e<t.totalPages;a(s=>({...s,subscriptions:n,totalCount:t.totalCount,currentPage:e,hasMore:o,[c]:!1,error:null}))}else a(e=>({...e,[c]:!1,error:i.error||"Failed to fetch subscriptions"}))}catch(e){a(t=>({...t,[c]:!1,error:e instanceof Error?e.message:"Failed to fetch subscriptions"}))}},[t,s.filters,s.pageSize,s.subscriptions]),n=(0,r.useCallback)(async()=>{s.hasMore&&!s.isFetching&&await i(s.currentPage+1)},[i,s.hasMore,s.isFetching,s.currentPage]),o=(0,r.useCallback)(async()=>{await i(1,!0)},[i]),u=(0,r.useCallback)(async e=>{try{let s=await t.getSubscription(e);if(s.success&&s.data)return{success:!0,data:s.data};return{success:!1,error:s.error||"Failed to fetch subscription"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to fetch subscription"}}},[t]),d=(0,r.useCallback)(async e=>{a(e=>({...e,isCreating:!0,error:null}));try{let s=await t.createSubscription(e);if(s.success&&s.data)return a(e=>({...e,subscriptions:[s.data,...e.subscriptions],totalCount:e.totalCount+1,isCreating:!1,error:null})),{success:!0,data:s.data};return a(e=>({...e,isCreating:!1,error:s.error||"Failed to create subscription"})),{success:!1,error:s.error||"Failed to create subscription"}}catch(t){let e=t instanceof Error?t.message:"Failed to create subscription";return a(t=>({...t,isCreating:!1,error:e})),{success:!1,error:e}}},[t]),l=(0,r.useCallback)(async(e,s)=>{a(e=>({...e,isUpdating:!0,error:null}));try{let r=await t.updateSubscription(e,s);if(r.success&&r.data)return a(t=>{var s;return{...t,subscriptions:t.subscriptions.map(t=>t.id===e?r.data:t),selectedSubscription:(null===(s=t.selectedSubscription)||void 0===s?void 0:s.id)===e?r.data:t.selectedSubscription,isUpdating:!1,error:null}}),{success:!0,data:r.data};return a(e=>({...e,isUpdating:!1,error:r.error||"Failed to update subscription"})),{success:!1,error:r.error||"Failed to update subscription"}}catch(t){let e=t instanceof Error?t.message:"Failed to update subscription";return a(t=>({...t,isUpdating:!1,error:e})),{success:!1,error:e}}},[t]),p=(0,r.useCallback)(async e=>{a(e=>({...e,isDeleting:!0,error:null}));try{let s=await t.deleteSubscription(e);if(s.success)return a(t=>{var s;return{...t,subscriptions:t.subscriptions.filter(t=>t.id!==e),selectedSubscription:(null===(s=t.selectedSubscription)||void 0===s?void 0:s.id)===e?null:t.selectedSubscription,totalCount:t.totalCount-1,isDeleting:!1,error:null}}),{success:!0};return a(e=>({...e,isDeleting:!1,error:s.error||"Failed to delete subscription"})),{success:!1,error:s.error||"Failed to delete subscription"}}catch(t){let e=t instanceof Error?t.message:"Failed to delete subscription";return a(t=>({...t,isDeleting:!1,error:e})),{success:!1,error:e}}},[t]),b=(0,r.useCallback)(async(e,s)=>{try{let r=await t.suspendSubscription(e,s);if(r.success&&r.data)return a(t=>{var s;return{...t,subscriptions:t.subscriptions.map(t=>t.id===e?r.data:t),selectedSubscription:(null===(s=t.selectedSubscription)||void 0===s?void 0:s.id)===e?r.data:t.selectedSubscription}}),{success:!0,data:r.data};return{success:!1,error:r.error||"Failed to suspend subscription"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to suspend subscription"}}},[t]),h=(0,r.useCallback)(async e=>{try{let s=await t.resumeSubscription(e);if(s.success&&s.data)return a(t=>{var r;return{...t,subscriptions:t.subscriptions.map(t=>t.id===e?s.data:t),selectedSubscription:(null===(r=t.selectedSubscription)||void 0===r?void 0:r.id)===e?s.data:t.selectedSubscription}}),{success:!0,data:s.data};return{success:!1,error:s.error||"Failed to resume subscription"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to resume subscription"}}},[t]),g=(0,r.useCallback)(async(e,s)=>{try{let r=await t.cancelSubscription(e,s);if(r.success&&r.data)return a(t=>{var s;return{...t,subscriptions:t.subscriptions.map(t=>t.id===e?r.data:t),selectedSubscription:(null===(s=t.selectedSubscription)||void 0===s?void 0:s.id)===e?r.data:t.selectedSubscription}}),{success:!0,data:r.data};return{success:!1,error:r.error||"Failed to cancel subscription"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to cancel subscription"}}},[t]),S=(0,r.useCallback)(async(e,s)=>{try{let r=await t.renewSubscription(e,s);if(r.success&&r.data)return a(t=>{var s;return{...t,subscriptions:t.subscriptions.map(t=>t.id===e?r.data:t),selectedSubscription:(null===(s=t.selectedSubscription)||void 0===s?void 0:s.id)===e?r.data:t.selectedSubscription}}),{success:!0,data:r.data};return{success:!1,error:r.error||"Failed to renew subscription"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to renew subscription"}}},[t]),f=(0,r.useCallback)(async e=>{try{let s=await t.getSubscriptionDevices(e);if(s.success&&s.data)return{success:!0,data:s.data};return{success:!1,error:s.error||"Failed to fetch devices"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to fetch devices"}}},[t]),m=(0,r.useCallback)(async(e,s)=>{try{let r=await t.revokeDeviceAccess(e,s);if(r.success)return{success:!0};return{success:!1,error:r.error||"Failed to revoke device access"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to revoke device access"}}},[t]),y=(0,r.useCallback)(async e=>{try{let s=await t.validateLicenseKey(e);if(s.success&&s.data)return{success:!0,data:s.data};return{success:!1,error:s.error||"Failed to validate license key"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to validate license key"}}},[t]),v=(0,r.useCallback)(async e=>{try{let s=await t.generateLicenseKey(e);if(s.success&&s.data)return{success:!0,data:s.data};return{success:!1,error:s.error||"Failed to generate license key"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to generate license key"}}},[t]),E=(0,r.useCallback)(async(e,s)=>{try{let r=await t.bulkUpdateSubscriptions(e,s);if(r.success&&r.data)return await o(),{success:!0,data:r.data};return{success:!1,error:r.error||"Failed to bulk update subscriptions"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to bulk update subscriptions"}}},[t,o]),w=(0,r.useCallback)(e=>{a(t=>({...t,filters:{...t.filters,...e},currentPage:1}))},[]),C=(0,r.useCallback)(()=>{a(e=>({...e,filters:{},currentPage:1}))},[]),D=(0,r.useCallback)(e=>{a(t=>({...t,selectedSubscription:e}))},[]),k=(0,r.useCallback)(async()=>{try{return await t.exportSubscriptions(s.filters),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to export subscriptions"}}},[t,s.filters]),A=(0,r.useCallback)(()=>{a(e=>({...e,error:null}))},[]);return(0,r.useEffect)(()=>{i(1,!0)},[s.filters]),{...s,fetchSubscriptions:i,loadMore:n,refetch:o,getSubscription:u,createSubscription:d,updateSubscription:l,deleteSubscription:p,suspendSubscription:b,resumeSubscription:h,cancelSubscription:g,renewSubscription:S,getSubscriptionDevices:f,revokeDeviceAccess:m,validateLicenseKey:y,generateLicenseKey:v,bulkUpdateSubscriptions:E,setFilters:w,clearFilters:C,setSelectedSubscription:D,exportSubscriptions:k,clearError:A}}},28223:function(e,t,s){s.d(t,{x:function(){return c}});let r=s(83464).Z.create({baseURL:"http://localhost:8000",timeout:1e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});r.interceptors.request.use(e=>{let t=localStorage.getItem("auth_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),r.interceptors.response.use(e=>e,e=>{var t,s,r,a,c;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),window.location.href="/login"),(null===(s=e.response)||void 0===s?void 0:s.status)===403&&console.error("Permission denied"),(null===(r=e.response)||void 0===r?void 0:r.status)>=500&&console.error("Server error:",(null===(c=e.response)||void 0===c?void 0:null===(a=c.data)||void 0===a?void 0:a.message)||e.message),Promise.reject(e)});class a{async get(e,t){try{let s=await this.instance.get(e,t);return{success:!0,data:s.data}}catch(e){return this.handleError(e)}}async post(e,t,s){try{let r=await this.instance.post(e,t,s);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async put(e,t,s){try{let r=await this.instance.put(e,t,s);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async patch(e,t,s){try{let r=await this.instance.patch(e,t,s);return{success:!0,data:r.data}}catch(e){return this.handleError(e)}}async delete(e,t){try{let s=await this.instance.delete(e,t);return{success:!0,data:s.data}}catch(e){return this.handleError(e)}}handleError(e){if(e.response){var t;return{success:!1,error:(null===(t=e.response.data)||void 0===t?void 0:t.message)||e.response.statusText}}return e.request?{success:!1,error:"Network error - please check your internet connection"}:{success:!1,error:e.message||"An unexpected error occurred"}}async uploadFile(e,t,s){let r=new FormData;r.append("file",t);try{let t=await this.instance.post(e,r,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(s&&e.total){let t=Math.round(100*e.loaded/e.total);s(t)}}});return{success:!0,data:t.data}}catch(e){return this.handleError(e)}}async downloadFile(e,t){try{let s=await this.instance.get(e,{responseType:"blob"}),r=new Blob([s.data]),a=document.createElement("a");a.href=window.URL.createObjectURL(r),a.download=t,a.click(),window.URL.revokeObjectURL(a.href)}catch(e){throw console.error("File download failed:",e),e}}setAuthToken(e){this.instance.defaults.headers.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.instance.defaults.headers.Authorization}constructor(){this.instance=r}}let c=new a},6481:function(e,t,s){var r,a,c,i,n,o,u,d,l,p,b,h,g,S,f,m,y,v,E,w;s.d(t,{QV:function(){return a},XL:function(){return o},uG:function(){return u}}),(b=r||(r={})).ACTIVE="active",b.EXPIRED="expired",b.CANCELLED="cancelled",b.SUSPENDED="suspended",b.PENDING="pending",(h=a||(a={})).BASIC="basic",h.PROFESSIONAL="professional",h.ENTERPRISE="enterprise",(g=c||(c={})).ACTIVE="active",g.INACTIVE="inactive",g.SUSPENDED="suspended",g.DELETED="deleted",(S=i||(i={})).ACTIVE="active",S.INACTIVE="inactive",S.SUSPENDED="suspended",S.REVOKED="revoked",(f=n||(n={})).PENDING="pending",f.PROCESSING="processing",f.COMPLETED="completed",f.FAILED="failed",f.CANCELLED="cancelled",f.REFUNDED="refunded",f.PARTIALLY_REFUNDED="partially_refunded",f.EXPIRED="expired",(m=o||(o={})).MANUAL="manual",m.BANK_TRANSFER="bank_transfer",m.CREDIT_CARD="credit_card",m.DEBIT_CARD="debit_card",m.PAYPAL="paypal",m.STRIPE="stripe",m.CASH="cash",m.CHECK="check",m.WIRE_TRANSFER="wire_transfer",m.CRYPTOCURRENCY="cryptocurrency",m.OTHER="other",(y=u||(u={})).SUBSCRIPTION="subscription",y.RENEWAL="renewal",y.UPGRADE="upgrade",y.REFUND="refund",(v=d||(d={})).ADMIN="admin",v.MANAGER="manager",v.SUPPORT="support",v.VIEWER="viewer",(E=l||(l={})).SYSTEM="system",E.SECURITY="security",E.SUBSCRIPTION="subscription",E.DEVICE="device",E.BILLING="billing",(w=p||(p={})).LOW="low",w.MEDIUM="medium",w.HIGH="high",w.CRITICAL="critical"}}]);